{
    auto_https off
    admin off
    frankenphp
}

:80 {
    root * /app
    encode gzip
    
    # Arquivos estáticos da pasta public (assets, etc)
    @assets path /assets/*
    handle @assets {
        root * /app/public
        file_server
    }
    
    @manus path /__manus__/*
    handle @manus {
        root * /app/public
        file_server
    }
    
    # PHP API endpoints - processar primeiro
    @phpapi {
        path /api/* /user/* /ranking/* /pix/* /monetag/* /admin/* /admin-panel/* /invite/* /history/* /settings/* /withdraw/* /notifications/* /database/* /middleware/* /migrations/* /routes/*
    }
    handle @phpapi {
        php_server
    }
    
    # Arquivos PHP específicos
    @phpfile path *.php
    handle @phpfile {
        php_server
    }
    
    # SPA - todas as outras rotas vão para o index.html do React
    handle {
        root * /app/public
        try_files {path} /index.html
        file_server
    }
    
    # Configuração CORS
    header {
        Access-Control-Allow-Origin "*"
        Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
        Access-Control-Allow-Headers "*"
        Access-Control-Allow-Credentials "true"
        Access-Control-Max-Age "86400"
    }
    
    @options method OPTIONS
    respond @options 200
    
    @blocked path *.env *.sql *.log *.bak *.config .git/*
    respond @blocked 403
}
