<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Young Money - Minhas Tarefas</title>

    <!-- Telegram Web App SDK - OFICIAL -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <!-- VERIFICA√á√ÉO DO USER_ID NA URL - BUILD_MARKER_2026_02_05_v2 -->
    <script>
    (function() {
        'use strict';

        // Fun√ß√£o para obter par√¢metro da URL
        function getUrlParam(param) {
            var urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        // Verificar se user_id est√° presente na URL
        function hasValidUserId() {
            var userId = getUrlParam('user_id');
            // user_id deve existir e ser um n√∫mero v√°lido (ID do Telegram)
            return userId && userId.length > 0 && /^[0-9]+$/.test(userId);
        }

        // Armazenar user_id globalmente para uso posterior
        window.TELEGRAM_USER_ID = getUrlParam('user_id');

        function showBlockScreen() {
            document.documentElement.innerHTML = '<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Acesso Bloqueado</title><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:Inter,-apple-system,sans-serif;background:linear-gradient(135deg,#0a0e1a 0%,#0d1225 100%);color:#fff;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}.container{max-width:380px;text-align:center;animation:fadeIn .6s ease}.icon{width:100px;height:100px;margin:0 auto 25px;background:linear-gradient(135deg,#0088cc,#00a8e8);border-radius:24px;display:flex;align-items:center;justify-content:center;box-shadow:0 10px 40px rgba(0,136,204,.3)}.icon svg{width:60px;height:60px;fill:#fff}h1{font-size:1.5rem;margin-bottom:12px;font-weight:700}p{color:#a0aec0;margin-bottom:30px;line-height:1.6}.card{background:rgba(20,25,45,.9);border:1px solid rgba(139,92,246,.3);border-radius:16px;padding:25px;margin-bottom:20px;text-align:left}.step{display:flex;align-items:flex-start;gap:12px;margin-bottom:16px;color:#a0aec0;font-size:.95rem;line-height:1.5}.step:last-child{margin-bottom:0}.num{min-width:28px;height:28px;background:linear-gradient(135deg,#8b5cf6,#00ddff);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.85rem;color:#fff}.warn{display:flex;align-items:center;justify-content:center;gap:10px;padding:15px;background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.3);border-radius:12px;color:#ef4444;font-size:.9rem}.warn svg{width:20px;height:20px;fill:currentColor;flex-shrink:0}@keyframes fadeIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}</style></head><body><div class="container"><div class="icon"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/></svg></div><h1>Acesso Exclusivo</h1><p>Entre pelo Telegram</p><div class="card"><div class="step"><span class="num">1</span><span>Abra o <strong>Telegram</strong> no seu celular</span></div><div class="step"><span class="num">2</span><span>Acesse o <strong>bot oficial</strong> do YoungMoney</span></div><div class="step"><span class="num">3</span><span>Clique no bot√£o para abrir o <strong>Mini App</strong></span></div></div><div class="warn"><svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg><span>Acesso requer user_id v√°lido na URL</span></div></div></body></html>';
        }

        // Verificar imediatamente se user_id est√° presente
        if (!hasValidUserId()) {
            showBlockScreen();
        }
    })();
    </script>

    <!-- PROTE√á√ÉO ANTI-INSPE√á√ÉO -->
    <script>
    (function(){
        // Bloquear F12, Ctrl+Shift+I, Ctrl+U, clique direito
        document.addEventListener('keydown',function(e){
            if(e.keyCode===123||(e.ctrlKey&&e.shiftKey&&(e.keyCode===73||e.keyCode===74||e.keyCode===67))||(e.ctrlKey&&e.keyCode===85)){
                e.preventDefault();return false;
            }
        },true);
        document.addEventListener('contextmenu',function(e){e.preventDefault();return false;},true);
        
        // Detectar DevTools aberto
        var d=false,t=160;
        setInterval(function(){
            if(window.outerWidth-window.innerWidth>t||window.outerHeight-window.innerHeight>t){
                if(!d){d=true;document.body.innerHTML='';window.location.href='about:blank';}
            }else{d=false;}
        },1000);
        
        // Desabilitar console em produ√ß√£o
        if(location.hostname!=='localhost'){
            console.log=console.warn=console.error=console.info=console.debug=function(){};
        }
        
        // Anti-tampering: detectar modifica√ß√£o de fetch/XHR
        setInterval(function(){
            if(!fetch.toString().includes('[native code]')){
                document.body.innerHTML='';window.location.href='about:blank';
            }
        },5000);
    })();
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        /* === RESET E CORRE√á√ïES GLOBAIS === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            overflow-x: hidden;
            max-width: 100vw;
            width: 100%;
            height: 100%;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #0d1225;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --purple-neon: #8b5cf6;
            --cyan-neon: #00ddff;
            --green-neon: #10b981;
            --yellow-neon: #fbbf24;
            --card-bg: rgba(20, 25, 45, 0.85);
            --card-border: rgba(139, 92, 246, 0.4);
            --orange-neon: #f97316;
        }

        /* ========================================
           ESTILOS DA TELA DE MANUTEN√á√ÉO NOTURNA
           ======================================== */
        .night-maintenance-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: transparent;
            z-index: 99999;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .night-maintenance-overlay.active {
            display: flex;
        }

        .maintenance-container {
            max-width: 420px;
            width: 100%;
            text-align: center;
            animation: fadeInUp 0.8s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .moon-icon {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            position: relative;
            animation: floatMoon 4s ease-in-out infinite;
        }

        @keyframes floatMoon {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        .moon-icon svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.6));
        }

        .moon-stars {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
        }

        .moon-star {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--cyan-neon);
            border-radius: 50%;
            animation: starTwinkle 2s ease-in-out infinite;
        }

        .moon-star:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .moon-star:nth-child(2) { top: 5%; right: 20%; animation-delay: 0.5s; }
        .moon-star:nth-child(3) { bottom: 20%; left: 5%; animation-delay: 1s; }
        .moon-star:nth-child(4) { bottom: 10%; right: 10%; animation-delay: 1.5s; }
        .moon-star:nth-child(5) { top: 30%; right: 5%; animation-delay: 0.3s; width: 6px; height: 6px; }

        @keyframes starTwinkle {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.3; transform: scale(0.5); }
        }

        .maintenance-logo {
            font-family: 'Orbitron', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--purple-neon), var(--cyan-neon));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            letter-spacing: 3px;
        }

        .maintenance-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .maintenance-subtitle {
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .maintenance-card {
            background: rgba(20, 25, 45, 0.9);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.1), inset 0 0 30px rgba(0, 0, 0, 0.2);
        }

        .countdown-container { margin-bottom: 20px; }

        .countdown-label {
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.85rem;
            color: var(--cyan-neon);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
        }

        .countdown-timer {
            display: flex;
            justify-content: center;
            gap: 12px;
        }

        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .countdown-value {
            font-family: 'Orbitron', monospace;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--text-primary);
            background: linear-gradient(180deg, rgba(139, 92, 246, 0.2) 0%, rgba(0, 221, 255, 0.1) 100%);
            border: 1px solid rgba(139, 92, 246, 0.4);
            border-radius: 12px;
            padding: 10px 16px;
            min-width: 65px;
            text-shadow: 0 0 15px rgba(139, 92, 246, 0.5);
        }

        .countdown-unit {
            font-family: 'Inter', sans-serif;
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .countdown-separator {
            font-family: 'Orbitron', monospace;
            font-size: 2.2rem;
            color: var(--purple-neon);
            align-self: flex-start;
            padding-top: 10px;
            animation: blinkSep 1s ease-in-out infinite;
        }

        @keyframes blinkSep {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .return-time {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 15px 20px;
            background: linear-gradient(90deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 50%, rgba(16, 185, 129, 0.1) 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
        }

        .return-time i { font-size: 1.2rem; color: var(--green-neon); }
        .return-time-text { font-family: 'Rajdhani', sans-serif; font-size: 1rem; color: var(--green-neon); font-weight: 600; }
        .return-time-value { font-family: 'Orbitron', monospace; font-size: 1.2rem; color: var(--text-primary); font-weight: 700; }

        .maintenance-message {
            font-family: 'Inter', sans-serif;
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
            padding: 18px;
            background: rgba(249, 115, 22, 0.1);
            border: 1px solid rgba(249, 115, 22, 0.3);
            border-radius: 12px;
        }

        .maintenance-message i { color: var(--orange-neon); margin-right: 8px; }

        .pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 300px;
            height: 300px;
            border: 2px solid rgba(139, 92, 246, 0.15);
            border-radius: 50%;
            animation: pulseRingAnim 4s ease-out infinite;
            pointer-events: none;
        }

        .pulse-ring:nth-child(2) { animation-delay: 1.3s; }
        .pulse-ring:nth-child(3) { animation-delay: 2.6s; }

        @keyframes pulseRingAnim {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; }
        }

        @media (max-width: 480px) {
            .maintenance-logo { font-size: 1.5rem; }
            .maintenance-title { font-size: 1.4rem; letter-spacing: 1px; }
            .maintenance-subtitle { font-size: 0.9rem; }
            .countdown-value { font-size: 1.8rem; padding: 8px 12px; min-width: 55px; }
            .countdown-separator { font-size: 1.8rem; }
            .moon-icon { width: 100px; height: 100px; }
            .maintenance-card { padding: 20px; }
        }

        /* === FUNDO ESPACIAL COM ESTRELAS === */
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Container do fundo de estrelas */
        .stars-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            background: linear-gradient(180deg, #0a0e1a 0%, #0d1225 50%, #0a0e1a 100%);
        }

        /* Estrelas pequenas */
        .stars-small {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(1px 1px at 10% 20%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 25% 35%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 40% 15%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 55% 45%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 70% 25%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 85% 55%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 15% 65%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 30% 80%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 45% 70%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 60% 85%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 75% 75%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 90% 90%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 5% 40%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 20% 50%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 35% 30%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 50% 60%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 65% 40%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 80% 10%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 95% 30%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 8% 85%, rgba(255, 255, 255, 0.8) 0%, transparent 100%);
            animation: twinkle 4s ease-in-out infinite;
        }

        /* Estrelas m√©dias */
        .stars-medium {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 12% 28%, rgba(0, 221, 255, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 28% 42%, rgba(139, 92, 246, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 42% 18%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(2px 2px at 58% 52%, rgba(0, 221, 255, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 72% 32%, rgba(139, 92, 246, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 88% 62%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 18% 72%, rgba(0, 221, 255, 0.7) 0%, transparent 100%),
                radial-gradient(2px 2px at 32% 88%, rgba(139, 92, 246, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 48% 78%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 62% 92%, rgba(0, 221, 255, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 78% 82%, rgba(139, 92, 246, 0.7) 0%, transparent 100%),
                radial-gradient(2px 2px at 92% 95%, rgba(255, 255, 255, 0.5) 0%, transparent 100%);
            animation: twinkle 3s ease-in-out infinite reverse;
        }

        /* Estrelas grandes (brilhantes) */
        .stars-large {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(3px 3px at 15% 25%, rgba(255, 255, 255, 0.9) 0%, transparent 100%),
                radial-gradient(3px 3px at 45% 55%, rgba(0, 221, 255, 0.8) 0%, transparent 100%),
                radial-gradient(3px 3px at 75% 35%, rgba(139, 92, 246, 0.9) 0%, transparent 100%),
                radial-gradient(3px 3px at 25% 75%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(3px 3px at 85% 85%, rgba(0, 221, 255, 0.9) 0%, transparent 100%),
                radial-gradient(3px 3px at 55% 15%, rgba(139, 92, 246, 0.8) 0%, transparent 100%);
            animation: twinkle 5s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* === HEADER === */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            background: transparent;
            padding: 0 1rem;
        }

        .header-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.05em;
        }

        /* Linha decorativa abaixo do header */
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 5%;
            right: 5%;
            height: 1px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(0, 221, 255, 0.3) 20%,
                rgba(139, 92, 246, 0.5) 50%,
                rgba(0, 221, 255, 0.3) 80%,
                transparent 100%);
        }

        /* Pontos decorativos no header */
        .header-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--cyan-neon);
            border-radius: 50%;
            bottom: -2px;
        }

        .header-dot.left {
            left: 5%;
        }

        .header-dot.right {
            right: 5%;
        }

        /* Bot√£o Voltar */
        .back-button {
            position: absolute;
            left: 1rem;
            width: 2.5rem;
            height: 2.5rem;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: scale(1.1);
        }

        .back-button i {
            color: var(--text-primary);
            font-size: 1.25rem;
        }

        /* Bot√£o Refresh */
        .refresh-button {
            position: absolute;
            right: 1rem;
            width: 2rem;
            height: 2rem;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: rotate(180deg);
        }

        .refresh-button i {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* === LAYOUT PRINCIPAL === */
        .main-content {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 1rem 2rem;
            gap: 1rem;
        }

        /* === TASK CARD (apenas instru√ß√µes e barras de progresso) === */
        .task-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            padding: 1.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow:
                0 0 30px rgba(139, 92, 246, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
        }

        /* Pontos decorativos nos cantos do card */
        .task-card::before,
        .task-card::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .task-card::before {
            top: -3px;
            left: 20%;
            background: var(--cyan-neon);
            box-shadow: 0 0 8px var(--cyan-neon);
        }

        .task-card::after {
            top: -3px;
            right: 20%;
            background: var(--purple-neon);
            box-shadow: 0 0 8px var(--purple-neon);
        }

        /* Pontos adicionais */
        .card-dots {
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 0 15%;
        }

        .card-dot {
            width: 4px;
            height: 4px;
            background: rgba(139, 92, 246, 0.5);
            border-radius: 50%;
        }

        .task-description {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .task-description strong {
            color: var(--cyan-neon);
        }

        /* === PROGRESS SECTION === */
        .progress-section {
            margin-bottom: 0;
        }

        .progress-item {
            margin-bottom: 1rem;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .progress-label i {
            margin-right: 0.5rem;
            color: var(--text-secondary);
        }

        .progress-bar-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 0.5rem;
            height: 0.5rem;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            border-radius: 0.5rem;
            transition: width 0.5s ease;
            background: linear-gradient(90deg, var(--cyan-neon), var(--purple-neon));
            box-shadow: 0 0 10px rgba(0, 221, 255, 0.5);
        }

        .progress-bar.completed {
            background: linear-gradient(90deg, var(--green-neon), #34d399);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        /* === STATS GRID (FORA DO CARD) === */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            width: 100%;
            max-width: 400px;
        }

        .stat-box {
            background: rgba(20, 25, 45, 0.7);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 0.75rem;
            padding: 1.25rem 1rem;
            text-align: center;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--cyan-neon);
            text-shadow: 0 0 15px rgba(0, 221, 255, 0.5);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* === BUTTONS (FORA DO CARD) === */
        .button-container {
            width: 100%;
            max-width: 400px;
        }

        .ad-button {
            width: 100%;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 1rem;
            font-size: 1rem;
            border: none;
            background: linear-gradient(135deg, var(--purple-neon) 0%, #a855f7 100%);
            color: white;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .ad-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
        }

        .ad-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .ad-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .ad-button i {
            font-size: 1.1rem;
        }

        .spin-button {
            background: linear-gradient(135deg, var(--green-neon) 0%, #34d399 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .spin-button:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        /* === STATUS MESSAGE === */
        .status-message {
            text-align: center;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
            width: 100%;
            max-width: 400px;
        }

        .status-message.success {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--green-neon);
        }

        .status-message.warning {
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: var(--yellow-neon);
        }

        /* === SPINNER === */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === RESPONSIVE === */
        @media (max-height: 700px) {
            .main-content {
                padding-top: 70px;
                gap: 0.75rem;
            }

            .task-card {
                padding: 1.25rem;
            }

            .task-description {
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .ad-button {
                padding: 0.875rem;
            }
        }

        @media (max-height: 600px) {
            .header {
                height: 50px;
            }

            .main-content {
                padding-top: 60px;
                gap: 0.5rem;
            }

            .task-card {
                padding: 1rem;
            }

            .progress-item {
                margin-bottom: 0.75rem;
            }

            .stats-grid {
                gap: 0.5rem;
            }

            .stat-box {
                padding: 0.75rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

<!-- ========================================
     TELA DE MANUTEN√á√ÉO NOTURNA (21h - 00h)
     ======================================== -->
<div class="night-maintenance-overlay" id="nightMaintenanceOverlay">
    <div class="pulse-ring"></div>
    <div class="pulse-ring"></div>
    <div class="pulse-ring"></div>

    <div class="maintenance-container">
        <div class="maintenance-logo">YOUNG MONEY</div>

        <div class="moon-icon">
            <div class="moon-stars">
                <div class="moon-star"></div>
                <div class="moon-star"></div>
                <div class="moon-star"></div>
                <div class="moon-star"></div>
                <div class="moon-star"></div>
            </div>
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M21.0672 11.8568L20.4253 11.469L21.0672 11.8568ZM12.1432 2.93276L11.7553 2.29085V2.29085L12.1432 2.93276ZM21.25 12C21.25 17.1086 17.1086 21.25 12 21.25V22.75C17.9371 22.75 22.75 17.9371 22.75 12H21.25ZM12 21.25C6.89137 21.25 2.75 17.1086 2.75 12H1.25C1.25 17.9371 6.06294 22.75 12 22.75V21.25ZM2.75 12C2.75 6.89137 6.89137 2.75 12 2.75V1.25C6.06294 1.25 1.25 6.06294 1.25 12H2.75ZM15.5 14.25C12.3244 14.25 9.75 11.6756 9.75 8.5H8.25C8.25 12.5041 11.4959 15.75 15.5 15.75V14.25ZM20.4253 11.469C19.4172 13.1373 17.5882 14.25 15.5 14.25V15.75C18.1349 15.75 20.4407 14.3439 21.7092 12.2447L20.4253 11.469ZM9.75 8.5C9.75 6.41182 10.8627 4.5828 12.531 3.57467L11.7553 2.29085C9.65609 3.5593 8.25 5.86509 8.25 8.5H9.75ZM12 2.75C11.9115 2.75 11.8077 2.71008 11.7324 2.63168C11.6686 2.56527 11.6538 2.50244 11.6503 2.47703C11.6461 2.44587 11.6482 2.35557 11.7553 2.29085L12.531 3.57467C13.0342 3.27065 13.196 2.71398 13.1368 2.27627C13.0754 1.82126 12.7166 1.25 12 1.25V2.75ZM21.7092 12.2447C21.6444 12.3518 21.5541 12.3539 21.523 12.3497C21.4976 12.3462 21.4347 12.3314 21.3683 12.2676C21.2899 12.1923 21.25 12.0885 21.25 12H22.75C22.75 11.2834 22.1787 10.9246 21.7237 10.8632C21.286 10.804 20.7293 10.9658 20.4253 11.469L21.7092 12.2447Z" fill="url(#moonGradient)"/>
                <defs>
                    <linearGradient id="moonGradient" x1="12" y1="1" x2="12" y2="23" gradientUnits="userSpaceOnUse">
                        <stop stop-color="#8b5cf6"/>
                        <stop offset="1" stop-color="#00ddff"/>
                    </linearGradient>
                </defs>
            </svg>
        </div>

        <h1 class="maintenance-title">Hora de Descansar</h1>

        <p class="maintenance-subtitle">
            Nosso sistema est√° em manuten√ß√£o noturna.<br>
            Volte √† meia-noite para continuar ganhando!
        </p>

        <div class="maintenance-card">
            <div class="countdown-container">
                <div class="countdown-label">Sistema volta em</div>
                <div class="countdown-timer">
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdownHours">00</div>
                        <div class="countdown-unit">Horas</div>
                    </div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdownMinutes">00</div>
                        <div class="countdown-unit">Min</div>
                    </div>
                    <div class="countdown-separator">:</div>
                    <div class="countdown-item">
                        <div class="countdown-value" id="countdownSeconds">00</div>
                        <div class="countdown-unit">Seg</div>
                    </div>
                </div>
            </div>

            <div class="return-time">
                <i class="fas fa-clock"></i>
                <span class="return-time-text">Retorno √†s</span>
                <span class="return-time-value">00:00</span>
            </div>
        </div>

        <div class="maintenance-message">
            <i class="fas fa-moon"></i>
            <strong>Manuten√ß√£o di√°ria:</strong> Das 21h √†s 00h realizamos atualiza√ß√µes para melhorar sua experi√™ncia. Aproveite para descansar e volte √† meia-noite!
        </div>
    </div>
</div>

<script>
(function() {
    'use strict';
    const NIGHT_MAINTENANCE_START = 21;
    const NIGHT_MAINTENANCE_END = 0;

    function getBrasiliaTime() {
        const now = new Date();
        const brasiliaOffset = -3 * 60;
        const localOffset = now.getTimezoneOffset();
        return new Date(now.getTime() + (localOffset + brasiliaOffset) * 60000);
    }

    function isNightMaintenanceTime() {
        const brasiliaTime = getBrasiliaTime();
        const hour = brasiliaTime.getHours();
        console.log('[NIGHT CHECK] Hora de Bras√≠lia:', hour);
        return hour >= NIGHT_MAINTENANCE_START && hour <= 23;
    }

    // Verificar imediatamente e definir vari√°vel global
    window.isNightMaintenance = isNightMaintenanceTime();
    console.log('[NIGHT CHECK] Em manuten√ß√£o noturna:', window.isNightMaintenance);
})();
</script>

<!-- Fundo de estrelas -->
<div class="stars-background">
    <div class="stars-small"></div>
    <div class="stars-medium"></div>
    <div class="stars-large"></div>
</div>

<!-- Header -->
<header class="header">

    <span class="header-title">Minhas Tarefas</span>
    <button class="refresh-button" onclick="fetchStats()">
        <i class="fas fa-sync-alt"></i>
    </button>
    <span class="header-dot left"></span>
    <span class="header-dot right"></span>
</header>

<!-- Conte√∫do Principal -->
<main class="main-content">
    <!-- Card de Tarefas (apenas instru√ß√µes e barras de progresso) -->
    <div class="task-card">
        <div class="card-dots">
            <span class="card-dot"></span>
            <span class="card-dot"></span>
            <span class="card-dot"></span>
        </div>

        <div class="task-description">
            Complete a tarefa abaixo para desbloquear a roleta e ganhar pr√™mios!
            <br><br>
            ‚Ä¢ Assista <strong id="requiredImpressionsText"><i class="fas fa-spinner fa-spin"></i></strong> (impress√µes)
            <br>‚Ä¢ Clique em <strong id="requiredClicksText"><i class="fas fa-spinner fa-spin"></i></strong>
        </div>

        <div class="progress-section">
            <div class="progress-item">
                <div class="progress-label">
                    <span><i class="fas fa-eye"></i> An√∫ncios Assistidos</span>
                    <span id="impressionCount"><i class="fas fa-spinner fa-spin"></i></span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="impressionBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="progress-item">
                <div class="progress-label">
                    <span><i class="fas fa-hand-pointer"></i> Cliques Realizados</span>
                    <span id="clickCount"><i class="fas fa-spinner fa-spin"></i></span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="clickBar" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Grid (FORA do card) -->
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-value" id="statImpressions"><i class="fas fa-spinner fa-spin"></i></div>
            <div class="stat-label">Impress√µes</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="statClicks"><i class="fas fa-spinner fa-spin"></i></div>
            <div class="stat-label">Cliques</div>
        </div>
    </div>

    <!-- Bot√µes (FORA do card) -->
    <div class="button-container">
        <!-- Bot√£o ASSISTIR AN√öCIO - Oculto at√© carregar API -->
        <button class="ad-button" id="adButton" onclick="handleAdClick()" style="display: none;">
            <i class="fas fa-play"></i> ASSISTIR AN√öCIO
        </button>

        <!-- Bot√£o GIRAR ROLETA (aparece quando tarefa √© conclu√≠da) -->
        <button class="ad-button spin-button" id="spinButton" onclick="openSpinWheel()" style="display: none;">
            <i class="fas fa-dice"></i> GIRAR ROLETA
        </button>
    </div>

    <div id="statusMessage" class="status-message"></div>
</main>

<!-- ========================================
     SISTEMA DE OVERLAY FLUTUANTE DE 20 SEGUNDOS
     + BLOQUEIO PERMANENTE QUANDO ATINGIR LIMITE DE CLIQUES (PONCHIBEC)
     ======================================== -->
<script>
    (function() {
        'use strict';

        const OVERLAY_DURATION = 20;
        let overlayCreated = false;
        let overlayCountdown = OVERLAY_DURATION;
        let overlayInterval = null;

        console.log('[OVERLAY SYSTEM] Iniciado - Dura√ß√£o: ' + OVERLAY_DURATION + ' segundos');
        console.log('[PONCHIBEC] Sistema de bloqueio de cliques ativado');

        function createFloatingOverlay() {
            if (overlayCreated) {
                console.log('[OVERLAY] Overlay j√° existe, ignorando...');
                return;
            }

            overlayCreated = true;

            console.log('[OVERLAY] An√∫ncio detectado! Criando overlay flutuante de ' + OVERLAY_DURATION + ' segundos...');

            const overlay = document.createElement('div');
            overlay.id = 'monetag-block-overlay';
            overlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.1) !important;
                z-index: 2147483647 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                animation: fadeInOverlay 0.3s ease !important;
                pointer-events: auto !important;
            `;

            ['click', 'mousedown', 'mouseup', 'touchstart', 'touchend', 'touchmove', 'contextmenu', 'pointerdown', 'pointerup'].forEach(function(eventType) {
                overlay.addEventListener(eventType, function(e) {
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    console.log('[OVERLAY] Evento ' + eventType + ' bloqueado');
                    return false;
                }, true);
            });

            const message = document.createElement('div');
            message.style.cssText = `
                background: linear-gradient(135deg, rgba(20, 25, 45, 0.95) 0%, rgba(13, 18, 37, 0.95) 100%) !important;
                padding: 2rem !important;
                border-radius: 1rem !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 30px rgba(139, 92, 246, 0.2) !important;
                text-align: center !important;
                max-width: 90% !important;
                width: 320px !important;
                animation: scaleInOverlay 0.4s ease !important;
                pointer-events: auto !important;
                border: 1px solid rgba(139, 92, 246, 0.3) !important;
            `;

            message.innerHTML = `
                <div style="width: 3rem; height: 3rem; margin: 0 auto 1rem; position: relative;">
                    <svg viewBox="0 0 100 100" style="width: 100%; height: 100%; transform: rotate(-90deg);">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(139, 92, 246, 0.2)" stroke-width="8"></circle>
                        <circle id="overlay-progress-circle" cx="50" cy="50" r="45" fill="none" stroke="#00ddff" stroke-width="8" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="0" style="transition: stroke-dashoffset 1s linear;"></circle>
                    </svg>
                    <span id="overlay-timer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 700; color: #00ddff;">${OVERLAY_DURATION}</span>
                </div>
                <p style="margin: 0; color: #a0aec0; font-size: 0.875rem; font-family: 'Inter', sans-serif;">Realizando tarefa automaticamente...</p>
            `;

            overlay.appendChild(message);
            document.documentElement.appendChild(overlay);

            if (!document.getElementById('overlay-animations-style')) {
                const style = document.createElement('style');
                style.id = 'overlay-animations-style';
                style.textContent = `
                    @keyframes fadeInOverlay {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes scaleInOverlay {
                        from { opacity: 0; transform: scale(0.9) translateY(20px); }
                        to { opacity: 1; transform: scale(1) translateY(0); }
                    }
                    @keyframes fadeOutOverlay {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            function keepOverlayOnTop() {
                const overlayEl = document.getElementById('monetag-block-overlay');
                if (!overlayEl) return;
                if (overlayEl.parentNode !== document.documentElement || overlayEl !== document.documentElement.lastElementChild) {
                    document.documentElement.appendChild(overlayEl);
                }
                overlayEl.style.zIndex = '2147483647';
            }

            const topInterval = setInterval(keepOverlayOnTop, 100);

            const circumference = 283;
            overlayCountdown = OVERLAY_DURATION;

            // Flag para controlar se a impress√£o j√° foi enviada neste ciclo
            let impressionSentThisCycle = false;

            overlayInterval = setInterval(function() {
                overlayCountdown--;

                const timerEl = document.getElementById('overlay-timer');
                const progressCircle = document.getElementById('overlay-progress-circle');

                if (timerEl) timerEl.textContent = overlayCountdown;

                if (progressCircle) {
                    const progress = (OVERLAY_DURATION - overlayCountdown) / OVERLAY_DURATION;
                    progressCircle.style.strokeDashoffset = circumference * (1 - progress);
                }

                console.log('[OVERLAY] Contador: ' + overlayCountdown + ' segundos restantes');

                // ENVIAR IMPRESS√ÉO QUANDO CHEGAR EM 3 SEGUNDOS
                // Isso significa que o usu√°rio assistiu 17 segundos do an√∫ncio
                if (overlayCountdown === 3 && !impressionSentThisCycle) {
                    impressionSentThisCycle = true;
                    console.log('[OVERLAY] ‚úÖ Contador chegou em 3 segundos! Enviando impress√£o...');
                    
                    // Chamar fun√ß√£o global para enviar impress√£o
                    if (typeof window.sendImpressionFromOverlay === 'function') {
                        window.sendImpressionFromOverlay();
                    } else {
                        console.log('[OVERLAY] ‚ö†Ô∏è Fun√ß√£o sendImpressionFromOverlay n√£o encontrada');
                    }
                }

                if (overlayCountdown <= 0) {
                    clearInterval(overlayInterval);
                    clearInterval(topInterval);
                    console.log('[OVERLAY] Contador finalizado! Reiniciando p√°gina...');
                    window.location.reload();
                }
            }, 1000);

            console.log('[OVERLAY] Overlay criado com sucesso!');
        }

        function removeOverlay() {
            const overlay = document.getElementById('monetag-block-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOutOverlay 0.3s ease';
                setTimeout(function() {
                    overlay.remove();
                    overlayCreated = false;
                    console.log('[OVERLAY] Overlay removido!');
                }, 300);
            }
        }

        function detectMonetagAd() {
            const adIndicators = [
                'iframe[src*="monetag"]',
                'iframe[src*="libtl"]',
                'iframe[src*="ad"]',
                '[class*="monetag"]',
                '[id*="monetag"]',
                'div[style*="z-index: 2147483647"]',
                'div[style*="z-index:2147483647"]',
                'iframe[style*="z-index"]',
                'div[id^="container-"]',
                'iframe[id*="google_ads"]',
                'ins.adsbygoogle'
            ];

            for (let selector of adIndicators) {
                try {
                    const elements = document.querySelectorAll(selector);
                    if (elements.length > 0) {
                        console.log('[DETECTOR] An√∫ncio detectado via seletor:', selector);
                        return true;
                    }
                } catch (e) {}
            }

            const iframes = document.querySelectorAll('iframe');
            for (let iframe of iframes) {
                const src = iframe.src || '';
                const style = iframe.getAttribute('style') || '';
                if (src.includes('monetag') || src.includes('libtl') || src.includes('ad') || style.includes('z-index') || iframe.style.zIndex > 1000) {
                    console.log('[DETECTOR] Iframe de an√∫ncio detectado:', src);
                    return true;
                }
            }

            return false;
        }

        // ========================================
        // OVERLAY AUTOM√ÅTICO COM CONTADOR - REINICIA A P√ÅGINA
        // Aparece quando o usu√°rio atingiu o limite de cliques
        // ========================================
        const AUTO_RELOAD_DURATION = 20;
        let autoReloadActive = false;
        let autoReloadCountdown = AUTO_RELOAD_DURATION;
        let autoReloadInterval = null;

        function createAutoReloadOverlay() {
            if (autoReloadActive) {
                console.log('[AUTO-RELOAD] Overlay j√° ativo, ignorando...');
                return;
            }

            autoReloadActive = true;

            console.log('[AUTO-RELOAD] üîÑ Limite de cliques atingido! Criando overlay com contador de ' + AUTO_RELOAD_DURATION + 's...');

            // Remover overlay tempor√°rio se existir
            const tempOverlay = document.getElementById('monetag-block-overlay');
            if (tempOverlay) {
                tempOverlay.remove();
                overlayCreated = false;
            }

            const overlay = document.createElement('div');
            overlay.id = 'auto-reload-overlay';
            overlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.1) !important;
                z-index: 2147483647 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                animation: fadeInOverlay 0.3s ease !important;
                pointer-events: auto !important;
            `;

            // Bloquear eventos
            ['click', 'mousedown', 'mouseup', 'touchstart', 'touchend', 'touchmove', 'contextmenu', 'pointerdown', 'pointerup'].forEach(function(eventType) {
                overlay.addEventListener(eventType, function(e) {
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    console.log('[AUTO-RELOAD] Evento ' + eventType + ' bloqueado');
                    return false;
                }, true);
            });

            const message = document.createElement('div');
            message.style.cssText = `
                background: linear-gradient(135deg, rgba(20, 25, 45, 0.95) 0%, rgba(13, 18, 37, 0.95) 100%) !important;
                padding: 2rem !important;
                border-radius: 1rem !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 30px rgba(139, 92, 246, 0.2) !important;
                text-align: center !important;
                max-width: 90% !important;
                width: 320px !important;
                animation: scaleInOverlay 0.4s ease !important;
                pointer-events: auto !important;
                border: 1px solid rgba(139, 92, 246, 0.3) !important;
            `;

            message.innerHTML = `
                <div style="width: 3rem; height: 3rem; margin: 0 auto 1rem; position: relative;">
                    <svg viewBox="0 0 100 100" style="width: 100%; height: 100%; transform: rotate(-90deg);">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(139, 92, 246, 0.2)" stroke-width="8"></circle>
                        <circle id="auto-reload-progress-circle" cx="50" cy="50" r="45" fill="none" stroke="#00ddff" stroke-width="8" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="0" style="transition: stroke-dashoffset 1s linear;"></circle>
                    </svg>
                    <span id="auto-reload-timer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 700; color: #00ddff;">${AUTO_RELOAD_DURATION}</span>
                </div>
                <p style="margin: 0; color: #a0aec0; font-size: 0.875rem; font-family: 'Inter', sans-serif;">Realizando tarefa automaticamente...</p>
            `;

            overlay.appendChild(message);
            document.documentElement.appendChild(overlay);

            // Manter overlay sempre no topo
            function keepAutoReloadOnTop() {
                const overlayEl = document.getElementById('auto-reload-overlay');
                if (!overlayEl) return;
                if (overlayEl.parentNode !== document.documentElement || overlayEl !== document.documentElement.lastElementChild) {
                    document.documentElement.appendChild(overlayEl);
                }
                overlayEl.style.zIndex = '2147483647';
            }

            const topInterval = setInterval(keepAutoReloadOnTop, 100);

            const circumference = 283;
            autoReloadCountdown = AUTO_RELOAD_DURATION;

            autoReloadInterval = setInterval(function() {
                autoReloadCountdown--;

                const timerEl = document.getElementById('auto-reload-timer');
                const progressCircle = document.getElementById('auto-reload-progress-circle');

                if (timerEl) timerEl.textContent = autoReloadCountdown;

                if (progressCircle) {
                    const progress = (AUTO_RELOAD_DURATION - autoReloadCountdown) / AUTO_RELOAD_DURATION;
                    progressCircle.style.strokeDashoffset = circumference * (1 - progress);
                }

                console.log('[AUTO-RELOAD] Contador: ' + autoReloadCountdown + ' segundos restantes');

                if (autoReloadCountdown <= 0) {
                    clearInterval(autoReloadInterval);
                    clearInterval(topInterval);
                    console.log('[AUTO-RELOAD] Contador finalizado! Reiniciando p√°gina...');
                    window.location.reload();
                }
            }, 1000);

            console.log('[AUTO-RELOAD] ‚úÖ Overlay com contador criado com sucesso!');
        }

        function setupAdDetectionObserver() {
            let adDetected = false;

            const observer = new MutationObserver(function(mutations) {
                if (adDetected) return;

                // Verificar se um an√∫ncio apareceu
                if (detectMonetagAd()) {
                    console.log('[OBSERVER] An√∫ncio Monetag detectado via MutationObserver!');

                    // VERIFICAR SE O USU√ÅRIO J√Å ATINGIU O LIMITE DE CLIQUES
                    const userClicks = (typeof TaskState !== 'undefined' && TaskState.clicks) ? TaskState.clicks : 0;
                    const requiredClicks = (typeof REQUIRED_CLICKS !== 'undefined') ? REQUIRED_CLICKS : 2;

                    // Se atingiu o limite de cliques, mostrar overlay com contador que reinicia a p√°gina
                    if (userClicks >= requiredClicks) {
                        adDetected = true;
                        console.log('[AUTO-RELOAD] üîÑ Usu√°rio atingiu limite de cliques (' + userClicks + '/' + requiredClicks + '). Iniciando contador!');
                        createAutoReloadOverlay();
                    }
                    // Se tem pelo menos 1 clique mas n√£o atingiu o limite, mostrar overlay tempor√°rio
                    else if (userClicks >= 1) {
                        adDetected = true;
                        console.log('[OBSERVER] Usu√°rio tem ' + userClicks + ' clique(s). Mostrando overlay autom√°tico!');

                        // Criar overlay se ainda n√£o existe
                        if (!overlayCreated) {
                            createFloatingOverlay();
                        }
                    } else {
                        console.log('[OBSERVER] Usu√°rio ainda n√£o tem cliques (' + userClicks + '). Overlay N√ÉO ser√° exibido.');
                        // Resetar para poder detectar novamente no pr√≥ximo an√∫ncio
                        setTimeout(function() {
                            adDetected = false;
                        }, 2000);
                    }
                }
            });

            // Observar todo o documento
            observer.observe(document.documentElement, {
                childList: true,
                subtree: true,
                attributes: true,
                attributeFilter: ['style', 'class', 'src']
            });

            console.log('[OBSERVER] Observador de an√∫ncios ativado');
            console.log('[AUTO-RELOAD] Sistema de auto-reload configurado');
        }

        function initOverlaySystem() {
            console.log('[OVERLAY SYSTEM] Inicializando sistema de overlay...');
            console.log('[AUTO-RELOAD] Inicializando sistema de auto-reload...');
            setupAdDetectionObserver();
            console.log('[OVERLAY SYSTEM] Sistema de overlay inicializado com sucesso!');
            console.log('[AUTO-RELOAD] Sistema de auto-reload inicializado com sucesso!');
        }

        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            initOverlaySystem();
        } else {
            document.addEventListener('DOMContentLoaded', initOverlaySystem);
        }

        window.MontagOverlay = {
            show: createFloatingOverlay,
            hide: removeOverlay,
            showAutoReload: createAutoReloadOverlay
        };

    })();
</script>

<script>
    console.log('‚úÖ User Agent real capturado');
    console.log('UA:', navigator.userAgent);
</script>


<script>
    // ========================================
    // CONFIGURA√á√ÉO INTEGRADA COM SERVIDOR
    // ========================================

    const ZONE_ID = '10325249';
    const SDK_FUNC = 'show_10325249';
    const SCRIPT_SRC = 'https://libtl.com/sdk.js';

    const POSTBACK_SERVER = 'https://monetag-postback-server-production.up.railway.app';
    const POSTBACK_URL = `${POSTBACK_SERVER}/api/postback`;

    const YOUNGMONEY_API = 'https://youngmoney-api-railway-production-561a.up.railway.app/telegramyoung2';
    const PROFILE_ENDPOINT = `${YOUNGMONEY_API}/profile`;

    let REQUIRED_IMPRESSIONS = 20;
    let REQUIRED_CLICKS = 2;
    const AUTO_REFRESH_INTERVAL = 3000;

    // ========================================
    // CRIPTOGRAFIA DE DADOS
    // ========================================
    const _k = 'YM2025$ecr3t';
    
    // Fun√ß√£o para criptografar dados (XOR + Base64)
    function _enc(data) {
        const str = typeof data === 'string' ? data : JSON.stringify(data);
        let result = '';
        for (let i = 0; i < str.length; i++) {
            result += String.fromCharCode(str.charCodeAt(i) ^ _k.charCodeAt(i % _k.length));
        }
        return btoa(result);
    }
    
    // Fun√ß√£o para descriptografar dados
    function _dec(encoded) {
        try {
            const decoded = atob(encoded);
            let result = '';
            for (let i = 0; i < decoded.length; i++) {
                result += String.fromCharCode(decoded.charCodeAt(i) ^ _k.charCodeAt(i % _k.length));
            }
            return JSON.parse(result);
        } catch (e) {
            return null;
        }
    }
    
    // Wrapper seguro para fetch que ofusca URLs e dados no Network
    const _f = window.fetch;
    async function secureFetch(url, options = {}) {
        // Adicionar timestamp para evitar cache
        const separator = url.includes('?') ? '&' : '?';
        const secureUrl = url + separator + '_t=' + Date.now() + '&_r=' + Math.random().toString(36).substr(2, 5);
        
        try {
            const response = await _f(secureUrl, {
                ...options,
                headers: {
                    ...options.headers,
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-Client-Version': '2.0'
                }
            });
            return response;
        } catch (e) {
            throw e;
        }
    }

    const TaskState = {
        userId: null,
        userEmail: null,
        impressions: 0,
        clicks: 0,
        currentClickId: null,
        isProcessing: false,
        isLoading: false,
        lastImpressions: 0,
        lastClicks: 0,
        lastEventId: 0,
        requiredImpressionsLoaded: false,
        lastImpressionSent: 0,
        lastClickSent: 0
    };

    let autoRefreshInterval = null;

    // ========================================
    // VERIFICA√á√ÉO DE STATUS DO SITE (ONLINE/OFFLINE)
    // ========================================
    async function checkSiteStatus(userId) {
        try {
            const response = await fetch(`${YOUNGMONEY_API}/api/site_status.php?user_id=${userId}`);
            const data = await response.json();
            
            if (data.success) {
                // Se o site est√° offline E o usu√°rio N√ÉO tem acesso
                if (!data.data.is_online && !data.data.user_has_access) {
                    showMaintenanceScreen();
                    return false;
                }
            }
            return true;
        } catch (error) {
            console.log('[SITE STATUS] Erro ao verificar status:', error);
            // Em caso de erro, permitir acesso (fail-open)
            return true;
        }
    }

    // ========================================
    // TELA DE MANUTEN√á√ÉO - SITE OFFLINE
    // ========================================
    function showMaintenanceScreen() {
        document.body.innerHTML = '';
        
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
            }
            @keyframes pulse-glow {
                0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.3); }
                50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.5); }
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: scale(0.95); }
                to { opacity: 1; transform: scale(1); }
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);
        
        const maintenanceScreen = document.createElement('div');
        maintenanceScreen.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #0a0e1a 0%, #0d1225 50%, #0a0e1a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            overflow: hidden;
        `;
        
        maintenanceScreen.innerHTML = `
            <div style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image: 
                    radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.3), transparent),
                    radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.2), transparent),
                    radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.3), transparent),
                    radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.2), transparent),
                    radial-gradient(1px 1px at 160px 120px, rgba(255,255,255,0.4), transparent);
                background-size: 200px 200px;
                pointer-events: none;
            "></div>
            
            <div style="
                background: rgba(15, 20, 35, 0.9);
                backdrop-filter: blur(20px);
                padding: 3rem 2.5rem;
                border-radius: 24px;
                text-align: center;
                max-width: 90%;
                width: 400px;
                border: 1px solid rgba(251, 191, 36, 0.3);
                animation: fadeIn 0.5s ease-out, pulse-glow 3s ease-in-out infinite;
                position: relative;
            ">
                <div style="
                    width: 80px;
                    height: 80px;
                    margin: 0 auto 2rem;
                    background: linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(251, 191, 36, 0.1) 100%);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border: 2px solid rgba(251, 191, 36, 0.3);
                    animation: float 3s ease-in-out infinite;
                ">
                    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 8V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
                
                <h1 style="
                    margin: 0 0 0.75rem 0;
                    color: #fbbf24;
                    font-size: 1.75rem;
                    font-weight: 600;
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                    letter-spacing: -0.5px;
                ">Em Manuten√ß√£o</h1>
                
                <p style="
                    margin: 0 0 1.5rem 0;
                    color: #64748b;
                    font-size: 0.95rem;
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                    line-height: 1.6;
                ">Estamos realizando melhorias no sistema. Por favor, volte em alguns minutos.</p>
                
                <div style="
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 8px;
                    color: #64748b;
                    font-size: 0.85rem;
                ">
                    <div style="
                        width: 16px;
                        height: 16px;
                        border: 2px solid rgba(251, 191, 36, 0.3);
                        border-top-color: #fbbf24;
                        border-radius: 50%;
                        animation: spin 1s linear infinite;
                    "></div>
                    <span>Aguarde...</span>
                </div>
            </div>
        `;
        
        document.body.appendChild(maintenanceScreen);
        console.log('[MAINTENANCE] Tela de manuten√ß√£o exibida - site offline');
    }

    // ========================================
    // TELA DE BLOQUEIO - SEM YMID
    // ========================================
    function showBlockedScreen() {
        // Esconder todo o conte√∫do principal
        document.body.innerHTML = '';
        
        // Adicionar estilos de anima√ß√£o
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
            }
            @keyframes pulse-glow {
                0%, 100% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.3); }
                50% { box-shadow: 0 0 40px rgba(139, 92, 246, 0.5); }
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: scale(0.95); }
                to { opacity: 1; transform: scale(1); }
            }
            @keyframes marquee {
                0% { transform: translateX(100%); }
                100% { transform: translateX(-100%); }
            }
        `;
        document.head.appendChild(style);
        
        // Criar tela de bloqueio
        const blockedScreen = document.createElement('div');
        blockedScreen.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #0a0e1a 0%, #0d1225 50%, #0a0e1a 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            overflow: hidden;
        `;
        
        blockedScreen.innerHTML = `
            <!-- Estrelas de fundo -->
            <div style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image: 
                    radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.3), transparent),
                    radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.2), transparent),
                    radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.3), transparent),
                    radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.2), transparent),
                    radial-gradient(1px 1px at 160px 120px, rgba(255,255,255,0.4), transparent);
                background-size: 200px 200px;
                pointer-events: none;
            "></div>
            
            <!-- Card principal -->
            <div style="
                background: rgba(15, 20, 35, 0.9);
                backdrop-filter: blur(20px);
                padding: 3rem 2.5rem;
                border-radius: 24px;
                text-align: center;
                max-width: 90%;
                width: 400px;
                border: 1px solid rgba(139, 92, 246, 0.2);
                animation: fadeIn 0.5s ease-out, pulse-glow 3s ease-in-out infinite;
                position: relative;
            ">
                <!-- √çcone de cadeado -->
                <div style="
                    width: 80px;
                    height: 80px;
                    margin: 0 auto 2rem;
                    background: linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border: 2px solid rgba(139, 92, 246, 0.3);
                    animation: float 3s ease-in-out infinite;
                ">
                    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 11H5C3.89543 11 3 11.8954 3 13V20C3 21.1046 3.89543 22 5 22H19C20.1046 22 21 21.1046 21 20V13C21 11.8954 20.1046 11 19 11Z" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M7 11V7C7 5.67392 7.52678 4.40215 8.46447 3.46447C9.40215 2.52678 10.6739 2 12 2C13.3261 2 14.5979 2.52678 15.5355 3.46447C16.4732 4.40215 17 5.67392 17 7V11" stroke="#8b5cf6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="12" cy="16" r="1" fill="#8b5cf6"/>
                    </svg>
                </div>
                
                <!-- T√≠tulo -->
                <h1 style="
                    margin: 0 0 0.75rem 0;
                    color: #ffffff;
                    font-size: 1.75rem;
                    font-weight: 600;
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                    letter-spacing: -0.5px;
                ">Acesso Restrito</h1>
                
                <!-- Subt√≠tulo -->
                <p style="
                    margin: 0 0 2rem 0;
                    color: #64748b;
                    font-size: 0.95rem;
                    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
                    line-height: 1.6;
                ">Esta p√°gina requer autentica√ß√£o v√°lida para ser acessada.</p>
                
            </div>
        `;
        
        document.body.appendChild(blockedScreen);
        console.log('[BLOCKED] Tela de bloqueio exibida - sem ymid');
    }

    // ========================================
    // SISTEMA DE POSTBACK - IMPRESS√ÉO S√ì VIA OVERLAY
    // A impress√£o S√ì √© enviada quando o overlay chegar em 3 segundos
    // N√ÉO envia impress√£o automaticamente quando an√∫ncio abre/fecha
    // ========================================
    
    // Fun√ß√£o para detectar tipo de evento baseado na URL
    function detectEventType(url) {
        if (url.includes('event_type=click') || url.includes('event_type%3Dclick')) {
            return 'click';
        }
        if (url.includes('event_type=impression') || url.includes('event_type%3Dimpression')) {
            return 'impression';
        }
        return null;
    }
    
    // Fun√ß√£o para verificar se √© um postback do Monetag (cont√©m {ymid} n√£o substitu√≠do)
    function isMonetagPostback(url) {
        return (url.includes('youngmoney-api-railway') || url.includes('monetag-postback-server')) && 
               (url.includes('%7Bymid%7D') || url.includes('{ymid}'));
    }
    
    async function sendPostbackToServer(type) {
        if (!TaskState.userId) return;
        
        // Evitar duplicatas (cooldown de 3 segundos)
        const now = Date.now();
        if (type === 'impression' && now - TaskState.lastImpressionSent < 3000) {
            console.log('[INTERCEPTOR] Impress√£o ignorada (cooldown)');
            return;
        }
        if (type === 'click' && now - TaskState.lastClickSent < 3000) {
            console.log('[INTERCEPTOR] Clique ignorado (cooldown)');
            return;
        }
        
        if (type === 'impression') TaskState.lastImpressionSent = now;
        if (type === 'click') TaskState.lastClickSent = now;
        
        console.log(`[INTERCEPTOR] üéØ ${type.toUpperCase()} ENVIANDO!`);
        
        // Enviar para o servidor de postback principal
        const params = new URLSearchParams({
            event_type: type,
            zone_id: ZONE_ID,
            ymid: TaskState.userId,
            user_email: TaskState.userEmail || 'unknown',
            estimated_price: type === 'click' ? '0.0045' : '0.0023'
        });
        
        const url = `${POSTBACK_URL}?${params.toString()}`;
        console.log(`[INTERCEPTOR] üì§ Enviando ${type} para:`, url);
        
        try {
            const response = await fetch(url, { method: 'GET', mode: 'cors' });
            const data = await response.json();
            console.log(`[INTERCEPTOR] ‚úÖ ${type} registrado:`, data);
            setTimeout(() => fetchStats(), 500);
        } catch (err) {
            console.error(`[INTERCEPTOR] ‚ùå Erro ao enviar ${type}:`, err);
        }
    }
    
    // Interceptar fetch - detectar postbacks do Monetag
    const originalFetch = window.fetch;
    window.fetch = function(...args) {
        const url = args[0]?.url || args[0] || '';
        if (typeof url === 'string' && isMonetagPostback(url)) {
            console.log('[INTERCEPTOR] üö´ Postback do Monetag interceptado:', url);
            const eventType = detectEventType(url);
            if (eventType === 'click') {
                // Cliques s√£o enviados imediatamente
                sendPostbackToServer('click');
            } else if (eventType === 'impression') {
                // Impress√µes: N√ÉO enviar aqui! S√≥ ser√° enviada quando o overlay chegar em 3 segundos
                console.log('[INTERCEPTOR] üì∫ Impress√£o detectada - aguardando overlay chegar em 3 segundos para contabilizar...');
                // N√£o faz nada aqui, a impress√£o ser√° enviada pelo overlay
            }
            // Bloquear a requisi√ß√£o original e retornar sucesso
            return Promise.resolve(new Response(JSON.stringify({success: true}), { status: 200 }));
        }
        return originalFetch.apply(this, args);
    };
    
    // Interceptar XMLHttpRequest - detectar postbacks do Monetag
    const originalXHROpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(method, url, ...rest) {
        if (typeof url === 'string' && isMonetagPostback(url)) {
            console.log('[INTERCEPTOR] üö´ XHR Postback do Monetag interceptado:', url);
            const eventType = detectEventType(url);
            if (eventType === 'click') {
                sendPostbackToServer('click');
            } else if (eventType === 'impression') {
                // Impress√µes: N√ÉO enviar aqui! S√≥ ser√° enviada quando o overlay chegar em 3 segundos
                console.log('[INTERCEPTOR] üì∫ Impress√£o detectada - aguardando overlay chegar em 3 segundos para contabilizar...');
            }
            // Redirecionar para about:blank para bloquear
            return originalXHROpen.call(this, method, 'about:blank', ...rest);
        }
        return originalXHROpen.call(this, method, url, ...rest);
    };
    
    // Interceptar Image (pixel tracking) - detectar postbacks do Monetag
    const originalImage = window.Image;
    window.Image = function() {
        const img = new originalImage();
        const originalSrcSetter = Object.getOwnPropertyDescriptor(HTMLImageElement.prototype, 'src').set;
        Object.defineProperty(img, 'src', {
            set: function(value) {
                if (typeof value === 'string' && isMonetagPostback(value)) {
                    console.log('[INTERCEPTOR] üö´ Image Postback do Monetag interceptado:', value);
                    const eventType = detectEventType(value);
                    if (eventType === 'click') {
                        sendPostbackToServer('click');
                    } else if (eventType === 'impression') {
                        // Impress√µes: N√ÉO enviar aqui! S√≥ ser√° enviada quando o overlay chegar em 3 segundos
                        console.log('[INTERCEPTOR] üì∫ Impress√£o detectada - aguardando overlay chegar em 3 segundos para contabilizar...');
                    }
                    // N√£o definir o src para bloquear a requisi√ß√£o
                    return;
                }
                originalSrcSetter.call(this, value);
            },
            get: function() {
                return this.getAttribute('src');
            }
        });
        return img;
    };
    
    console.log('[INTERCEPTOR] üîç Interceptadores de postback ativados');
    console.log('[INTERCEPTOR] üì∫ Impress√µes s√≥ ser√£o contabilizadas quando o contador do overlay chegar em 3 segundos');
    
    // FUN√á√ÉO GLOBAL para o overlay chamar quando o contador chegar em 3 segundos
    window.sendImpressionFromOverlay = function() {
        console.log('[OVERLAY->POSTBACK] üéØ Enviando impress√£o do overlay...');
        sendPostbackToServer('impression');
    };

    async function fetchRequiredImpressions() {
        try {
            console.log('[REQUIREMENTS] Buscando progresso do usu√°rio da API...');
            const url = `${YOUNGMONEY_API}/monetag/progress.php?user_id=${TaskState.userId || 1}`;
            console.log('[REQUIREMENTS] URL:', url);

            const response = await fetch(url);
            const data = await response.json();

            console.log('[REQUIREMENTS] Resposta:', data);

            if (data.success && data.data) {
                // Carregar valores necess√°rios
                REQUIRED_IMPRESSIONS = data.data.required_impressions || 20;
                REQUIRED_CLICKS = data.data.required_clicks || 2;
                
                // Carregar progresso atual do usu√°rio
                TaskState.impressions = data.data.impressions || 0;
                TaskState.clicks = data.data.clicks || 0;
                TaskState.requiredImpressionsLoaded = true;

                console.log('[REQUIREMENTS] ‚úÖ Valores carregados da API:');
                console.log('[REQUIREMENTS]   - Impress√µes atuais:', TaskState.impressions);
                console.log('[REQUIREMENTS]   - Cliques atuais:', TaskState.clicks);
                console.log('[REQUIREMENTS]   - Impress√µes necess√°rias:', REQUIRED_IMPRESSIONS);
                console.log('[REQUIREMENTS]   - Cliques necess√°rios:', REQUIRED_CLICKS);

                // Atualizar textos din√¢micos na tela
                const reqImpText = document.getElementById('requiredImpressionsText');
                const reqClickText = document.getElementById('requiredClicksText');

                if (reqImpText) {
                    reqImpText.textContent = REQUIRED_IMPRESSIONS + ' an√∫ncios';
                }
                if (reqClickText) {
                    reqClickText.textContent = REQUIRED_CLICKS + (REQUIRED_CLICKS === 1 ? ' an√∫ncio' : ' an√∫ncios');
                }

                // Revelar o bot√£o Assistir An√∫ncio ap√≥s carregar API
                const adButton = document.getElementById('adButton');
                if (adButton) {
                    adButton.style.display = 'flex';
                    console.log('[REQUIREMENTS] ‚úÖ Bot√£o Assistir An√∫ncio revelado');
                }

                updateUI();
            } else {
                console.warn('[REQUIREMENTS] ‚ö†Ô∏è Usando valores padr√£o');
                TaskState.requiredImpressionsLoaded = true;
                
                // Mesmo com valores padr√£o, revelar o bot√£o
                const adButton = document.getElementById('adButton');
                if (adButton) {
                    adButton.style.display = 'flex';
                }
                
                // Atualizar textos com valores padr√£o
                const reqImpText = document.getElementById('requiredImpressionsText');
                const reqClickText = document.getElementById('requiredClicksText');
                if (reqImpText) reqImpText.textContent = REQUIRED_IMPRESSIONS + ' an√∫ncios';
                if (reqClickText) reqClickText.textContent = REQUIRED_CLICKS + ' an√∫ncios';
                
                updateUI();
            }
        } catch (error) {
            console.error('[REQUIREMENTS] ‚ùå Erro ao buscar requisitos:', error);
            TaskState.requiredImpressionsLoaded = true;
            
            // Mesmo com erro, revelar o bot√£o com valores padr√£o
            const adButton = document.getElementById('adButton');
            if (adButton) {
                adButton.style.display = 'flex';
            }
            
            // Atualizar textos com valores padr√£o
            const reqImpText = document.getElementById('requiredImpressionsText');
            const reqClickText = document.getElementById('requiredClicksText');
            if (reqImpText) reqImpText.textContent = REQUIRED_IMPRESSIONS + ' an√∫ncios';
            if (reqClickText) reqClickText.textContent = REQUIRED_CLICKS + ' an√∫ncios';
            
            updateUI();
        }
    }

    function fetchUserProfileAsync() {
        fetch(PROFILE_ENDPOINT, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            credentials: 'include'
        })
        .then(response => response.ok ? response.json() : Promise.reject())
        .then(data => {
            let email = data.email || (data.user && data.user.email) || (data.data && data.data.email);
            TaskState.userEmail = email || 'unknown@youngmoney.com';
            console.log('[PROFILE] ‚úÖ Email obtido:', TaskState.userEmail);
        })
        .catch(err => {
            console.error('[PROFILE] ‚ùå Erro:', err);
            TaskState.userEmail = 'unknown@youngmoney.com';
        });
    }

    // Postback agora √© feito pelos interceptadores de rede acima

    function loadMonetagSDK() {
        const script = document.createElement('script');
        script.src = SCRIPT_SRC;
        script.setAttribute('data-zone', ZONE_ID);
        script.setAttribute('data-sdk', SDK_FUNC);
        script.async = true;
        document.head.appendChild(script);
        console.log('[SDK] Carregando Monetag...');
    }

    async function init() {
        console.log('='.repeat(50));
        console.log('[INIT] üöÄ Iniciando aplica√ß√£o...');
        console.log('[INIT] Servidor de Postback:', POSTBACK_SERVER);

        console.log('[INIT] window.Android existe?', typeof window.Android !== 'undefined');
        console.log('[INIT] window.AndroidInterface existe?', typeof window.AndroidInterface !== 'undefined');

        // Pegar ymid da URL
        const urlParams = new URLSearchParams(window.location.search);
        const ymidFromUrl = urlParams.get('ymid');
        
        if (ymidFromUrl) {
            console.log('[INIT] ‚úÖ ymid encontrado na URL:', ymidFromUrl);
            TaskState.userId = ymidFromUrl;
            TaskState.userEmail = `user_${ymidFromUrl}@youngmoney.com`;
        } else if (window.Android || window.AndroidInterface) {
            try {
                const androidInterface = window.Android || window.AndroidInterface;
                console.log('[INIT] ‚úÖ Interface Android encontrada:', androidInterface);

                const rawUserId = androidInterface.getUserId?.();
                const rawEmail = androidInterface.getEmail?.();

                console.log('[INIT] üì• Dados recebidos do Android:');
                console.log('[INIT]   - rawUserId:', rawUserId);
                console.log('[INIT]   - rawEmail:', rawEmail);

                TaskState.userId = rawUserId;
                TaskState.userEmail = rawEmail;

            } catch (e) {
                console.error('[INIT] ‚ùå ERRO ao obter dados do Android:', e);
            }
        }
        
        // Se n√£o tiver userId, mostrar tela de bloqueio
        if (!TaskState.userId) {
            console.error('[INIT] ‚ùå Nenhum ymid fornecido na URL!');
            showBlockedScreen();
            return;
        }

        // VERIFICAR STATUS DO SITE (ONLINE/OFFLINE)
        console.log('[INIT] üîç Verificando status do site...');
        const siteAccessible = await checkSiteStatus(TaskState.userId);
        if (!siteAccessible) {
            console.log('[INIT] ‚ö†Ô∏è Site em manuten√ß√£o - usu√°rio sem acesso');
            return; // Tela de manuten√ß√£o j√° foi exibida
        }
        console.log('[INIT] ‚úÖ Site acess√≠vel para este usu√°rio');

        fetchUserProfileAsync();
        fetchRequiredImpressions();
        updateUI();
        loadMonetagSDK();
        fetchStats();
    }

    async function fetchEvents() {
        try {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            console.log(`[EVENTS] [${timestamp}] Buscando novos eventos desde ID ${TaskState.lastEventId}...`);

            const url = `${POSTBACK_SERVER}/api/events?since_id=${TaskState.lastEventId}`;
            const response = await fetch(url);
            const data = await response.json();

            console.log('[EVENTS] Resposta:', data);

            if (data.success && data.events && data.events.length > 0) {
                console.log(`[EVENTS] ${data.count} novo(s) evento(s) detectado(s)!`);

                data.events.forEach(event => {
                    if (event.event_type === 'impression') {
                        TaskState.impressions++;
                    } else if (event.event_type === 'click') {
                        TaskState.clicks++;
                    }
                });

                TaskState.lastEventId = data.last_event_id;
                updateUI();
            }
        } catch (error) {
            console.error('[EVENTS] Erro ao buscar eventos:', error);
        } finally {
            TaskState.isLoading = false;
        }
    }

    async function fetchStats() {
        try {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            console.log(`[STATS] [${timestamp}] Buscando estat√≠sticas do usu√°rio ${TaskState.userId}...`);

            // Usar a API progress.php para buscar estat√≠sticas
            const url = `${YOUNGMONEY_API}/monetag/progress.php?user_id=${TaskState.userId}`;
            const response = await fetch(url);
            const data = await response.json();

            console.log('[STATS] Resposta:', data);

            if (data.success && data.data) {
                const newImpressions = data.data.impressions || 0;
                const newClicks = data.data.clicks || 0;

                const hasChanges = newImpressions !== TaskState.lastImpressions || newClicks !== TaskState.lastClicks;

                if (hasChanges) {
                    TaskState.impressions = newImpressions;
                    TaskState.clicks = newClicks;
                    TaskState.lastImpressions = newImpressions;
                    TaskState.lastClicks = newClicks;
                    
                    // Atualizar tamb√©m os valores necess√°rios caso tenham mudado
                    REQUIRED_IMPRESSIONS = data.data.required_impressions || REQUIRED_IMPRESSIONS;
                    REQUIRED_CLICKS = data.data.required_clicks || REQUIRED_CLICKS;
                    
                    updateUI();
                }
            }
        } catch (error) {
            console.error('[STATS] ‚ùå Erro ao buscar estat√≠sticas:', error);
        } finally {
            TaskState.isLoading = false;
            updateUI();
        }
    }

    function goBack() {
        console.log('[BACK] Bot√£o voltar clicado - Abrindo app com.youngmoney2');
        
        // Abrir o app pelo package name
        window.location.href = 'intent://scan/#Intent;scheme=com.youngmoney2;package=com.youngmoney2;end';
    }

    // ========================================
    // REFRESH AUTOM√ÅTICO AO VOLTAR PARA A TELA
    // ========================================
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'visible') {
            console.log('[VISIBILITY] üîÑ P√°gina ficou vis√≠vel - Atualizando dados...');
            fetchStats();
            fetchRequiredImpressions();
        }
    });

    // Tamb√©m atualiza quando a janela ganha foco
    window.addEventListener('focus', function() {
        console.log('[FOCUS] üîÑ Janela ganhou foco - Atualizando dados...');
        fetchStats();
        fetchRequiredImpressions();
    });

    function updateUI() {
        // S√ì atualizar valores se a API j√° carregou
        if (!TaskState.requiredImpressionsLoaded) {
            // Manter spinners - n√£o fazer nada
            return;
        }
        
        // Contadores (valores grandes nos boxes)
        document.getElementById('statImpressions').textContent = TaskState.impressions;
        document.getElementById('statClicks').textContent = TaskState.clicks;

        // Progresso de impress√µes (barra)
        const impressionProgress = Math.min((TaskState.impressions / REQUIRED_IMPRESSIONS) * 100, 100);
        document.getElementById('impressionBar').style.width = impressionProgress + '%';
        document.getElementById('impressionCount').textContent = `${TaskState.impressions}/${REQUIRED_IMPRESSIONS}`;

        if (TaskState.impressions >= REQUIRED_IMPRESSIONS) {
            document.getElementById('impressionBar').classList.add('completed');
        }

        // Progresso de cliques (barra)
        const clickProgress = Math.min((TaskState.clicks / REQUIRED_CLICKS) * 100, 100);
        document.getElementById('clickBar').style.width = clickProgress + '%';
        document.getElementById('clickCount').textContent = `${TaskState.clicks}/${REQUIRED_CLICKS}`;

        if (TaskState.clicks >= REQUIRED_CLICKS) {
            document.getElementById('clickBar').classList.add('completed');
        }

        // Bot√£o
        const button = document.getElementById('adButton');

        const taskCompleted = TaskState.requiredImpressionsLoaded &&
                              TaskState.impressions >= REQUIRED_IMPRESSIONS &&
                              TaskState.clicks >= REQUIRED_CLICKS;

        if (taskCompleted) {
            button.style.display = 'none';
            showStatus('<i class="fas fa-check-circle"></i> Parab√©ns! Tarefa conclu√≠da. Volte para girar a roleta!', 'success');
        } else {
            hideStatus();
            // S√≥ mostrar bot√£o se API j√° carregou
            button.style.display = 'flex';
            button.disabled = TaskState.isLoading || TaskState.isProcessing;

            if (TaskState.isLoading) {
                button.innerHTML = '<span class="spinner"></span> CARREGANDO DADOS...';
            } else if (TaskState.isProcessing) {
                button.innerHTML = '<span class="spinner"></span> CARREGANDO...';
            } else {
                button.innerHTML = '<i class="fas fa-play"></i> ASSISTIR AN√öNCIO';
            }
        }
    }

    // Fun√ß√£o sendPostbackToNewServer removida.
    // O Monetag envia os postbacks diretamente para o servidor configurado na plataforma.

    function showStatus(message, type) {
        const statusEl = document.getElementById('statusMessage');
        statusEl.innerHTML = message;
        statusEl.className = `status-message ${type}`;
        statusEl.style.display = 'block';
    }

    function hideStatus() {
        const statusEl = document.getElementById('statusMessage');
        if (statusEl) {
            statusEl.style.display = 'none';
        }
    }

    function handleAdClick() {
        if (TaskState.isProcessing) return;

        TaskState.isProcessing = true;
        updateUI();

        TaskState.currentClickId = 'click_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        console.log('[AD] Click ID:', TaskState.currentClickId);

        if (typeof window[SDK_FUNC] !== 'function') {
            console.warn('[AD] SDK n√£o est√° pronto');
            TaskState.isProcessing = false;
            updateUI();
            showStatus('‚ö†Ô∏è Aguarde o carregamento...', 'warning');
            return;
        }

        console.log('[AD] Chamando SDK com ymid e requestVar');
        window[SDK_FUNC]({
            ymid: TaskState.userId,
            requestVar: TaskState.userEmail
        }).then(() => {
            console.log('[AD] ‚úÖ An√∫ncio exibido pelo Monetag');
            
            // Impress√£o ser√° detectada automaticamente pelo interceptador
            // N√£o enviar manualmente para evitar duplica√ß√£o

            setTimeout(() => {
                TaskState.isProcessing = false;
                updateUI();
            }, 2000);
        }).catch(err => {
            console.error('[AD] ‚ùå Erro:', err);
            TaskState.isProcessing = false;
            updateUI();
        });
    }

    function startAutoRefresh() {
        console.log('[AUTO-REFRESH] Desabilitado');
    }

    function stopAutoRefresh() {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
        }
    }

    function openSpinWheel() {
        console.log('[SPIN] Abrindo roleta...');
        stopAutoRefresh();

        if (window.AndroidInterface?.onTaskCompleted) {
            window.AndroidInterface.onTaskCompleted();
        } else if (window.Android?.onTaskCompleted) {
            window.Android.onTaskCompleted();
        }

        if (window.Telegram?.WebApp?.close) {
            window.Telegram.WebApp.close();
        }
    }

    window.addEventListener('DOMContentLoaded', function() {
        // VERIFICAR MANUTEN√á√ÉO NOTURNA PRIMEIRO
        if (window.isNightMaintenance) {
            console.log('[NIGHT MAINTENANCE] üåô Sistema em manuten√ß√£o noturna - modificando bot√£o');
            
            // Modificar o bot√£o ASSISTIR AN√öCIO para mostrar VOLTAMOS √Ä MEIA-NOITE
            const adButton = document.getElementById('adButton');
            if (adButton) {
                adButton.innerHTML = '<i class="fas fa-moon"></i> VOLTAMOS √Ä MEIA-NOITE';
                adButton.style.display = 'flex';
                adButton.disabled = true;
                adButton.style.background = 'linear-gradient(135deg, #4c1d95 0%, #6d28d9 100%)';
                adButton.style.cursor = 'not-allowed';
                adButton.style.opacity = '0.8';
            }
            
            // Atualizar textos de loading para valores padr√£o
            const reqImpText = document.getElementById('requiredImpressionsText');
            const reqClickText = document.getElementById('requiredClicksText');
            if (reqImpText) reqImpText.textContent = '9 an√∫ncios';
            if (reqClickText) reqClickText.textContent = '1 an√∫ncio';
            
            // Atualizar contadores
            const impressionCount = document.getElementById('impressionCount');
            const clickCount = document.getElementById('clickCount');
            const statImpressions = document.getElementById('statImpressions');
            const statClicks = document.getElementById('statClicks');
            if (impressionCount) impressionCount.textContent = '0/9';
            if (clickCount) clickCount.textContent = '0/1';
            if (statImpressions) statImpressions.textContent = '0';
            if (statClicks) statClicks.textContent = '0';
            
            return; // N√ÉO executar init durante manuten√ß√£o
        }
        init();
    });
</script>
</body>
</html>

