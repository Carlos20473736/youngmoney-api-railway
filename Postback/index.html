<!doctype html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Young Money - Minhas Tarefas</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Rajdhani:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <style>
        /* === RESET E CORRE√á√ïES GLOBAIS === */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            overflow-x: hidden;
            max-width: 100vw;
            width: 100%;
            height: 100%;
        }

        :root {
            --bg-primary: #0a0e1a;
            --bg-secondary: #0d1225;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --purple-neon: #8b5cf6;
            --cyan-neon: #00ddff;
            --green-neon: #10b981;
            --yellow-neon: #fbbf24;
            --card-bg: rgba(20, 25, 45, 0.85);
            --card-border: rgba(139, 92, 246, 0.4);
        }

        /* === FUNDO ESPACIAL COM ESTRELAS === */
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Container do fundo de estrelas */
        .stars-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
            background: linear-gradient(180deg, #0a0e1a 0%, #0d1225 50%, #0a0e1a 100%);
        }

        /* Estrelas pequenas */
        .stars-small {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(1px 1px at 10% 20%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 25% 35%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 40% 15%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 55% 45%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 70% 25%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 85% 55%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 15% 65%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 30% 80%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 45% 70%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 60% 85%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 75% 75%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 90% 90%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 5% 40%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 20% 50%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 35% 30%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 50% 60%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(1px 1px at 65% 40%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(1px 1px at 80% 10%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(1px 1px at 95% 30%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(1px 1px at 8% 85%, rgba(255, 255, 255, 0.8) 0%, transparent 100%);
            animation: twinkle 4s ease-in-out infinite;
        }

        /* Estrelas m√©dias */
        .stars-medium {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(2px 2px at 12% 28%, rgba(0, 221, 255, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 28% 42%, rgba(139, 92, 246, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 42% 18%, rgba(255, 255, 255, 0.7) 0%, transparent 100%),
                radial-gradient(2px 2px at 58% 52%, rgba(0, 221, 255, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 72% 32%, rgba(139, 92, 246, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 88% 62%, rgba(255, 255, 255, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 18% 72%, rgba(0, 221, 255, 0.7) 0%, transparent 100%),
                radial-gradient(2px 2px at 32% 88%, rgba(139, 92, 246, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 48% 78%, rgba(255, 255, 255, 0.6) 0%, transparent 100%),
                radial-gradient(2px 2px at 62% 92%, rgba(0, 221, 255, 0.5) 0%, transparent 100%),
                radial-gradient(2px 2px at 78% 82%, rgba(139, 92, 246, 0.7) 0%, transparent 100%),
                radial-gradient(2px 2px at 92% 95%, rgba(255, 255, 255, 0.5) 0%, transparent 100%);
            animation: twinkle 3s ease-in-out infinite reverse;
        }

        /* Estrelas grandes (brilhantes) */
        .stars-large {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(3px 3px at 15% 25%, rgba(255, 255, 255, 0.9) 0%, transparent 100%),
                radial-gradient(3px 3px at 45% 55%, rgba(0, 221, 255, 0.8) 0%, transparent 100%),
                radial-gradient(3px 3px at 75% 35%, rgba(139, 92, 246, 0.9) 0%, transparent 100%),
                radial-gradient(3px 3px at 25% 75%, rgba(255, 255, 255, 0.8) 0%, transparent 100%),
                radial-gradient(3px 3px at 85% 85%, rgba(0, 221, 255, 0.9) 0%, transparent 100%),
                radial-gradient(3px 3px at 55% 15%, rgba(139, 92, 246, 0.8) 0%, transparent 100%);
            animation: twinkle 5s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* === HEADER === */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            background: transparent;
            padding: 0 1rem;
        }

        .header-title {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.05em;
        }

        /* Linha decorativa abaixo do header */
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 5%;
            right: 5%;
            height: 1px;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(0, 221, 255, 0.3) 20%,
                rgba(139, 92, 246, 0.5) 50%,
                rgba(0, 221, 255, 0.3) 80%,
                transparent 100%);
        }

        /* Pontos decorativos no header */
        .header-dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--cyan-neon);
            border-radius: 50%;
            bottom: -2px;
        }

        .header-dot.left {
            left: 5%;
        }

        .header-dot.right {
            right: 5%;
        }

        /* Bot√£o Voltar */
        .back-button {
            position: absolute;
            left: 1rem;
            width: 2.5rem;
            height: 2.5rem;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: scale(1.1);
        }

        .back-button i {
            color: var(--text-primary);
            font-size: 1.25rem;
        }

        /* Bot√£o Refresh */
        .refresh-button {
            position: absolute;
            right: 1rem;
            width: 2rem;
            height: 2rem;
            background: transparent;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .refresh-button:hover {
            transform: rotate(180deg);
        }

        .refresh-button i {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* === LAYOUT PRINCIPAL === */
        .main-content {
            position: relative;
            z-index: 1;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 1rem 2rem;
            gap: 1rem;
        }

        /* === TASK CARD (apenas instru√ß√µes e barras de progresso) === */
        .task-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 1rem;
            padding: 1.5rem;
            width: 100%;
            max-width: 400px;
            box-shadow:
                0 0 30px rgba(139, 92, 246, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
            position: relative;
        }

        /* Pontos decorativos nos cantos do card */
        .task-card::before,
        .task-card::after {
            content: '';
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
        }

        .task-card::before {
            top: -3px;
            left: 20%;
            background: var(--cyan-neon);
            box-shadow: 0 0 8px var(--cyan-neon);
        }

        .task-card::after {
            top: -3px;
            right: 20%;
            background: var(--purple-neon);
            box-shadow: 0 0 8px var(--purple-neon);
        }

        /* Pontos adicionais */
        .card-dots {
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-around;
            padding: 0 15%;
        }

        .card-dot {
            width: 4px;
            height: 4px;
            background: rgba(139, 92, 246, 0.5);
            border-radius: 50%;
        }

        .task-description {
            color: var(--text-primary);
            font-size: 0.95rem;
            line-height: 1.6;
            margin-bottom: 1.5rem;
        }

        .task-description strong {
            color: var(--cyan-neon);
        }

        /* === PROGRESS SECTION === */
        .progress-section {
            margin-bottom: 0;
        }

        .progress-item {
            margin-bottom: 1rem;
        }

        .progress-item:last-child {
            margin-bottom: 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-primary);
        }

        .progress-label i {
            margin-right: 0.5rem;
            color: var(--text-secondary);
        }

        .progress-bar-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 0.5rem;
            height: 0.5rem;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            border-radius: 0.5rem;
            transition: width 0.5s ease;
            background: linear-gradient(90deg, var(--cyan-neon), var(--purple-neon));
            box-shadow: 0 0 10px rgba(0, 221, 255, 0.5);
        }

        .progress-bar.completed {
            background: linear-gradient(90deg, var(--green-neon), #34d399);
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        /* === STATS GRID (FORA DO CARD) === */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            width: 100%;
            max-width: 400px;
        }

        .stat-box {
            background: rgba(20, 25, 45, 0.7);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 0.75rem;
            padding: 1.25rem 1rem;
            text-align: center;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--cyan-neon);
            text-shadow: 0 0 15px rgba(0, 221, 255, 0.5);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        /* === BUTTONS (FORA DO CARD) === */
        .button-container {
            width: 100%;
            max-width: 400px;
        }

        .ad-button {
            width: 100%;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 1rem;
            font-size: 1rem;
            border: none;
            background: linear-gradient(135deg, var(--purple-neon) 0%, #a855f7 100%);
            color: white;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .ad-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
        }

        .ad-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .ad-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .ad-button i {
            font-size: 1.1rem;
        }

        .spin-button {
            background: linear-gradient(135deg, var(--green-neon) 0%, #34d399 100%);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .spin-button:hover:not(:disabled) {
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        }

        /* === STATUS MESSAGE === */
        .status-message {
            text-align: center;
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
            width: 100%;
            max-width: 400px;
        }

        .status-message.success {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--green-neon);
        }

        .status-message.warning {
            background: rgba(251, 191, 36, 0.15);
            border: 1px solid rgba(251, 191, 36, 0.3);
            color: var(--yellow-neon);
        }

        /* === SPINNER === */
        .spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === RESPONSIVE === */
        @media (max-height: 700px) {
            .main-content {
                padding-top: 70px;
                gap: 0.75rem;
            }

            .task-card {
                padding: 1.25rem;
            }

            .task-description {
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }

            .stat-value {
                font-size: 1.75rem;
            }

            .ad-button {
                padding: 0.875rem;
            }
        }

        @media (max-height: 600px) {
            .header {
                height: 50px;
            }

            .main-content {
                padding-top: 60px;
                gap: 0.5rem;
            }

            .task-card {
                padding: 1rem;
            }

            .progress-item {
                margin-bottom: 0.75rem;
            }

            .stats-grid {
                gap: 0.5rem;
            }

            .stat-box {
                padding: 0.75rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>

<!-- Fundo de estrelas -->
<div class="stars-background">
    <div class="stars-small"></div>
    <div class="stars-medium"></div>
    <div class="stars-large"></div>
</div>

<!-- Header -->
<header class="header">
    <div class="back-button" onclick="goBack()">
        <i class="fas fa-arrow-left"></i>
    </div>
    <span class="header-title">Minhas Tarefas</span>
    <button class="refresh-button" onclick="fetchStats()">
        <i class="fas fa-sync-alt"></i>
    </button>
    <span class="header-dot left"></span>
    <span class="header-dot right"></span>
</header>

<!-- Conte√∫do Principal -->
<main class="main-content">
    <!-- Card de Tarefas (apenas instru√ß√µes e barras de progresso) -->
    <div class="task-card">
        <div class="card-dots">
            <span class="card-dot"></span>
            <span class="card-dot"></span>
            <span class="card-dot"></span>
        </div>

        <div class="task-description">
            Complete a tarefa abaixo para desbloquear a roleta e ganhar pr√™mios!
            <br><br>
            ‚Ä¢ Assista <strong id="requiredImpressionsText">20 an√∫ncios</strong> (impress√µes)
            <br>‚Ä¢ Clique em <strong id="requiredClicksText">2 an√∫ncios</strong>
        </div>

        <div class="progress-section">
            <div class="progress-item">
                <div class="progress-label">
                    <span><i class="fas fa-eye"></i> An√∫ncios Assistidos</span>
                    <span id="impressionCount">0/20</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="impressionBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="progress-item">
                <div class="progress-label">
                    <span><i class="fas fa-hand-pointer"></i> Cliques Realizados</span>
                    <span id="clickCount">0/2</span>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="clickBar" style="width: 0%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stats Grid (FORA do card) -->
    <div class="stats-grid">
        <div class="stat-box">
            <div class="stat-value" id="statImpressions">0</div>
            <div class="stat-label">Impress√µes</div>
        </div>
        <div class="stat-box">
            <div class="stat-value" id="statClicks">0</div>
            <div class="stat-label">Cliques</div>
        </div>
    </div>

    <!-- Bot√µes (FORA do card) -->
    <div class="button-container">
        <!-- Bot√£o ASSISTIR AN√öNCIO -->
        <button class="ad-button" id="adButton" onclick="handleAdClick()" style="display: flex;">
            <i class="fas fa-play"></i> ASSISTIR AN√öNCIO
        </button>

        <!-- Bot√£o GIRAR ROLETA (aparece quando tarefa √© conclu√≠da) -->
        <button class="ad-button spin-button" id="spinButton" onclick="openSpinWheel()" style="display: none;">
            <i class="fas fa-dice"></i> GIRAR ROLETA
        </button>
    </div>

    <div id="statusMessage" class="status-message"></div>
</main>

<!-- ========================================
     SISTEMA DE OVERLAY FLUTUANTE DE 20 SEGUNDOS
     + BLOQUEIO PERMANENTE QUANDO ATINGIR LIMITE DE CLIQUES (PONCHIBEC)
     ======================================== -->
<script>
    (function() {
        'use strict';

        const OVERLAY_DURATION = 20;
        let overlayCreated = false;
        let overlayCountdown = OVERLAY_DURATION;
        let overlayInterval = null;

        console.log('[OVERLAY SYSTEM] Iniciado - Dura√ß√£o: ' + OVERLAY_DURATION + ' segundos');
        console.log('[PONCHIBEC] Sistema de bloqueio de cliques ativado');

        function createFloatingOverlay() {
            if (overlayCreated) {
                console.log('[OVERLAY] Overlay j√° existe, ignorando...');
                return;
            }

            overlayCreated = true;

            console.log('[OVERLAY] An√∫ncio detectado! Criando overlay flutuante de ' + OVERLAY_DURATION + ' segundos...');

            const overlay = document.createElement('div');
            overlay.id = 'monetag-block-overlay';
            overlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.1) !important;
                z-index: 2147483647 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                animation: fadeInOverlay 0.3s ease !important;
                pointer-events: auto !important;
            `;

            ['click', 'mousedown', 'mouseup', 'touchstart', 'touchend', 'touchmove', 'contextmenu', 'pointerdown', 'pointerup'].forEach(function(eventType) {
                overlay.addEventListener(eventType, function(e) {
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    console.log('[OVERLAY] Evento ' + eventType + ' bloqueado');
                    return false;
                }, true);
            });

            const message = document.createElement('div');
            message.style.cssText = `
                background: linear-gradient(135deg, rgba(20, 25, 45, 0.95) 0%, rgba(13, 18, 37, 0.95) 100%) !important;
                padding: 2rem !important;
                border-radius: 1rem !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 30px rgba(139, 92, 246, 0.2) !important;
                text-align: center !important;
                max-width: 90% !important;
                width: 320px !important;
                animation: scaleInOverlay 0.4s ease !important;
                pointer-events: auto !important;
                border: 1px solid rgba(139, 92, 246, 0.3) !important;
            `;

            message.innerHTML = `
                <div style="width: 3rem; height: 3rem; margin: 0 auto 1rem; position: relative;">
                    <svg viewBox="0 0 100 100" style="width: 100%; height: 100%; transform: rotate(-90deg);">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="rgba(139, 92, 246, 0.2)" stroke-width="8"></circle>
                        <circle id="overlay-progress-circle" cx="50" cy="50" r="45" fill="none" stroke="#00ddff" stroke-width="8" stroke-linecap="round" stroke-dasharray="283" stroke-dashoffset="0" style="transition: stroke-dashoffset 1s linear;"></circle>
                    </svg>
                    <span id="overlay-timer" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 700; color: #00ddff;">${OVERLAY_DURATION}</span>
                </div>
                <p style="margin: 0; color: #a0aec0; font-size: 0.875rem; font-family: 'Inter', sans-serif;">Realizando tarefa automaticamente...</p>
            `;

            overlay.appendChild(message);
            document.documentElement.appendChild(overlay);

            if (!document.getElementById('overlay-animations-style')) {
                const style = document.createElement('style');
                style.id = 'overlay-animations-style';
                style.textContent = `
                    @keyframes fadeInOverlay {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes scaleInOverlay {
                        from { opacity: 0; transform: scale(0.9) translateY(20px); }
                        to { opacity: 1; transform: scale(1) translateY(0); }
                    }
                    @keyframes fadeOutOverlay {
                        from { opacity: 1; }
                        to { opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }

            function keepOverlayOnTop() {
                const overlayEl = document.getElementById('monetag-block-overlay');
                if (!overlayEl) return;
                if (overlayEl.parentNode !== document.documentElement || overlayEl !== document.documentElement.lastElementChild) {
                    document.documentElement.appendChild(overlayEl);
                }
                overlayEl.style.zIndex = '2147483647';
            }

            const topInterval = setInterval(keepOverlayOnTop, 100);

            const circumference = 283;
            overlayCountdown = OVERLAY_DURATION;

            overlayInterval = setInterval(function() {
                overlayCountdown--;

                const timerEl = document.getElementById('overlay-timer');
                const progressCircle = document.getElementById('overlay-progress-circle');

                if (timerEl) timerEl.textContent = overlayCountdown;

                if (progressCircle) {
                    const progress = (OVERLAY_DURATION - overlayCountdown) / OVERLAY_DURATION;
                    progressCircle.style.strokeDashoffset = circumference * (1 - progress);
                }

                console.log('[OVERLAY] Contador: ' + overlayCountdown + ' segundos restantes');

                if (overlayCountdown <= 0) {
                    clearInterval(overlayInterval);
                    clearInterval(topInterval);
                    console.log('[OVERLAY] Contador finalizado! Reiniciando p√°gina...');
                    window.location.reload();
                }
            }, 1000);

            console.log('[OVERLAY] Overlay criado com sucesso!');
        }

        function removeOverlay() {
            const overlay = document.getElementById('monetag-block-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOutOverlay 0.3s ease';
                setTimeout(function() {
                    overlay.remove();
                    overlayCreated = false;
                    console.log('[OVERLAY] Overlay removido!');
                }, 300);
            }
        }

        function detectMonetagAd() {
            const adIndicators = [
                'iframe[src*="monetag"]',
                'iframe[src*="libtl"]',
                'iframe[src*="ad"]',
                '[class*="monetag"]',
                '[id*="monetag"]',
                'div[style*="z-index: 2147483647"]',
                'div[style*="z-index:2147483647"]',
                'iframe[style*="z-index"]',
                'div[id^="container-"]',
                'iframe[id*="google_ads"]',
                'ins.adsbygoogle'
            ];

            for (let selector of adIndicators) {
                try {
                    const elements = document.querySelectorAll(selector);
                    if (elements.length > 0) {
                        console.log('[DETECTOR] An√∫ncio detectado via seletor:', selector);
                        return true;
                    }
                } catch (e) {}
            }

            const iframes = document.querySelectorAll('iframe');
            for (let iframe of iframes) {
                const src = iframe.src || '';
                const style = iframe.getAttribute('style') || '';
                if (src.includes('monetag') || src.includes('libtl') || src.includes('ad') || style.includes('z-index') || iframe.style.zIndex > 1000) {
                    console.log('[DETECTOR] Iframe de an√∫ncio detectado:', src);
                    return true;
                }
            }

            return false;
        }

        // ========================================
        // OVERLAY PERMANENTE - BLOQUEIO DE CLIQUES (PONCHIBEC)
        // Aparece quando o usu√°rio atingiu o limite de cliques
        // ========================================
        let permanentBlockActive = false;

        function createPermanentBlockOverlay() {
            if (permanentBlockActive) {
                console.log('[PONCHIBEC] Bloqueio permanente j√° ativo, ignorando...');
                return;
            }

            permanentBlockActive = true;

            console.log('[PONCHIBEC] üîí LIMITE DE CLIQUES ATINGIDO! Criando bloqueio permanente...');

            // Remover overlay tempor√°rio se existir
            const tempOverlay = document.getElementById('monetag-block-overlay');
            if (tempOverlay) {
                tempOverlay.remove();
                overlayCreated = false;
            }

            const overlay = document.createElement('div');
            overlay.id = 'ponchibec-block-overlay';
            overlay.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                background: rgba(0, 0, 0, 0.85) !important;
                z-index: 2147483647 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                animation: fadeInOverlay 0.3s ease !important;
                pointer-events: auto !important;
            `;

            // Bloquear TODOS os eventos
            ['click', 'mousedown', 'mouseup', 'touchstart', 'touchend', 'touchmove', 'contextmenu', 'pointerdown', 'pointerup', 'keydown', 'keyup', 'keypress'].forEach(function(eventType) {
                overlay.addEventListener(eventType, function(e) {
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    console.log('[PONCHIBEC] Evento ' + eventType + ' BLOQUEADO permanentemente');
                    return false;
                }, true);
            });

            const message = document.createElement('div');
            message.style.cssText = `
                background: linear-gradient(135deg, rgba(20, 25, 45, 0.98) 0%, rgba(13, 18, 37, 0.98) 100%) !important;
                padding: 2.5rem !important;
                border-radius: 1.5rem !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.7), 0 0 50px rgba(16, 185, 129, 0.3) !important;
                text-align: center !important;
                max-width: 90% !important;
                width: 350px !important;
                animation: scaleInOverlay 0.4s ease !important;
                pointer-events: auto !important;
                border: 2px solid rgba(16, 185, 129, 0.5) !important;
            `;

            message.innerHTML = `
                <div style="width: 4rem; height: 4rem; margin: 0 auto 1.5rem; background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg style="width: 2rem; height: 2rem; color: white;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                    </svg>
                </div>
                <h2 style="margin: 0 0 0.75rem 0; color: #10b981; font-size: 1.5rem; font-weight: 700; font-family: 'Rajdhani', sans-serif;">Limite de Cliques Atingido!</h2>
                <p style="margin: 0 0 1.5rem 0; color: #a0aec0; font-size: 0.95rem; font-family: 'Inter', sans-serif; line-height: 1.5;">Voc√™ j√° completou todos os cliques necess√°rios. Agora complete as impress√µes restantes para desbloquear a roleta!</p>
                <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem;">
                    <p style="margin: 0; color: #10b981; font-size: 0.875rem; font-family: 'Inter', sans-serif;">üéØ Continue assistindo os an√∫ncios para completar as impress√µes</p>
                </div>
                <button id="ponchibec-continue-btn" style="
                    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
                    color: white;
                    border: none;
                    padding: 1rem 2rem;
                    border-radius: 0.75rem;
                    font-size: 1rem;
                    font-weight: 600;
                    font-family: 'Rajdhani', sans-serif;
                    cursor: pointer;
                    transition: all 0.3s ease;
                    box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
                ">CONTINUAR ASSISTINDO</button>
            `;

            overlay.appendChild(message);
            document.documentElement.appendChild(overlay);

            // Bot√£o para fechar o overlay e continuar
            const continueBtn = document.getElementById('ponchibec-continue-btn');
            if (continueBtn) {
                continueBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    console.log('[PONCHIBEC] Usu√°rio clicou em continuar');
                    overlay.style.animation = 'fadeOutOverlay 0.3s ease';
                    setTimeout(function() {
                        overlay.remove();
                        permanentBlockActive = false;
                        console.log('[PONCHIBEC] Overlay de bloqueio removido');
                    }, 300);
                });
            }

            // Manter overlay sempre no topo
            function keepPonchibecOnTop() {
                const overlayEl = document.getElementById('ponchibec-block-overlay');
                if (!overlayEl) return;
                if (overlayEl.parentNode !== document.documentElement || overlayEl !== document.documentElement.lastElementChild) {
                    document.documentElement.appendChild(overlayEl);
                }
                overlayEl.style.zIndex = '2147483647';
            }

            setInterval(keepPonchibecOnTop, 100);

            console.log('[PONCHIBEC] üîí Bloqueio permanente ativado com sucesso!');
        }

        function setupAdDetectionObserver() {
            let adDetected = false;

            const observer = new MutationObserver(function(mutations) {
                if (adDetected) return;

                // Verificar se um an√∫ncio apareceu
                if (detectMonetagAd()) {
                    console.log('[OBSERVER] An√∫ncio Monetag detectado via MutationObserver!');

                    // VERIFICAR SE O USU√ÅRIO J√Å ATINGIU O LIMITE DE CLIQUES
                    const userClicks = (typeof TaskState !== 'undefined' && TaskState.clicks) ? TaskState.clicks : 0;
                    const requiredClicks = (typeof REQUIRED_CLICKS !== 'undefined') ? REQUIRED_CLICKS : 2;

                    // Se atingiu o limite de cliques, mostrar bloqueio permanente (PONCHIBEC)
                    if (userClicks >= requiredClicks) {
                        adDetected = true;
                        console.log('[PONCHIBEC] üîí Usu√°rio atingiu limite de cliques (' + userClicks + '/' + requiredClicks + '). BLOQUEANDO!');
                        createPermanentBlockOverlay();
                    }
                    // Se tem pelo menos 1 clique mas n√£o atingiu o limite, mostrar overlay tempor√°rio
                    else if (userClicks >= 1) {
                        adDetected = true;
                        console.log('[OBSERVER] Usu√°rio tem ' + userClicks + ' clique(s). Mostrando overlay autom√°tico!');

                        // Criar overlay se ainda n√£o existe
                        if (!overlayCreated) {
                            createFloatingOverlay();
                        }
                    } else {
                        console.log('[OBSERVER] Usu√°rio ainda n√£o tem cliques (' + userClicks + '). Overlay N√ÉO ser√° exibido.');
                        // Resetar para poder detectar novamente no pr√≥ximo an√∫ncio
                        setTimeout(function() {
                            adDetected = false;
                        }, 2000);
                    }
                }
            });

            // Observar todo o documento
            observer.observe(document.documentElement, {
                childList: true,
                subtree: true,
                attributes: true,
                attributeFilter: ['style', 'class', 'src']
            });

            console.log('[OBSERVER] Observador de an√∫ncios ativado');
            console.log('[PONCHIBEC] Sistema de bloqueio de cliques configurado');
        }

        function initOverlaySystem() {
            console.log('[OVERLAY SYSTEM] Inicializando sistema de overlay...');
            console.log('[PONCHIBEC] Inicializando sistema de bloqueio de cliques...');
            setupAdDetectionObserver();
            console.log('[OVERLAY SYSTEM] Sistema de overlay inicializado com sucesso!');
            console.log('[PONCHIBEC] Sistema de bloqueio inicializado com sucesso!');
        }

        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            initOverlaySystem();
        } else {
            document.addEventListener('DOMContentLoaded', initOverlaySystem);
        }

        window.MontagOverlay = {
            show: createFloatingOverlay,
            hide: removeOverlay,
            showPermanentBlock: createPermanentBlockOverlay
        };

    })();
</script>

<script>
    console.log('‚úÖ User Agent real capturado');
    console.log('UA:', navigator.userAgent);
</script>

<!-- Telegram Web App SDK -->
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', function() {
        const now = Math.floor(Date.now() / 1000);
        const userId = 1000000000 + Math.floor(Math.random() * 1000000000);

        if (!window.Telegram || !window.Telegram.WebApp || !window.Telegram.WebApp.initDataUnsafe || !window.Telegram.WebApp.initDataUnsafe.user) {
            console.log('‚ö†Ô∏è SDK oficial do Telegram n√£o forneceu dados, criando simula√ß√£o...');

            if (!window.Telegram) {
                window.Telegram = {};
            }

            window.Telegram.WebApp = {
                initData: `query_id=AAHdF6IQAAAAAN0XohDhrOrc&user=%7B%22id%22%3A${userId}%2C%22first_name%22%3A%22User%22%2C%22last_name%22%3A%22Test%22%2C%22username%22%3A%22testuser%22%2C%22language_code%22%3A%22pt%22%2C%22allows_write_to_pm%22%3Atrue%7D&auth_date=${now}&hash=abcdef1234567890`,
                initDataUnsafe: {
                    query_id: 'AAHdF6IQAAAAAN0XohDhrOrc',
                    user: {
                        id: userId,
                        first_name: 'User',
                        last_name: 'Test',
                        username: 'testuser',
                        language_code: 'pt',
                        allows_write_to_pm: true,
                        is_premium: false
                    },
                    auth_date: now,
                    hash: 'abcdef1234567890'
                },
                version: '7.0',
                platform: 'android',
                colorScheme: 'dark',
                themeParams: {
                    bg_color: '#0a0e1a',
                    text_color: '#ffffff',
                    hint_color: '#a0aec0',
                    link_color: '#00ddff',
                    button_color: '#8b5cf6',
                    button_text_color: '#ffffff',
                    secondary_bg_color: '#0d1225'
                },
                isExpanded: true,
                viewportHeight: window.innerHeight,
                viewportStableHeight: window.innerHeight,
                headerColor: '#0a0e1a',
                backgroundColor: '#0a0e1a',
                isClosingConfirmationEnabled: false,
                ready: function() { console.log('‚úÖ Telegram.WebApp.ready()'); },
                expand: function() { console.log('‚úÖ Telegram.WebApp.expand()'); },
                close: function() { console.log('‚úÖ Telegram.WebApp.close()'); },
                MainButton: {
                    text: 'CONTINUAR',
                    color: '#8b5cf6',
                    textColor: '#ffffff',
                    isVisible: false,
                    isActive: true,
                    setText: function(text) { this.text = text; },
                    onClick: function(callback) { },
                    show: function() { this.isVisible = true; },
                    hide: function() { this.isVisible = false; }
                },
                BackButton: {
                    isVisible: false,
                    show: function() { this.isVisible = true; },
                    hide: function() { this.isVisible = false; }
                },
                HapticFeedback: {
                    impactOccurred: function(style) { },
                    notificationOccurred: function(type) { },
                    selectionChanged: function() { }
                },
                sendData: function(data) {
                    console.log('Telegram.WebApp.sendData:', data);
                }
            };

            console.log('‚úÖ Ambiente Telegram simulado criado');
        } else {
            console.log('‚úÖ SDK oficial do Telegram funcionando');
        }

        console.log('User ID:', window.Telegram.WebApp.initDataUnsafe.user.id);
    });
</script>

<script>
    // ========================================
    // CONFIGURA√á√ÉO INTEGRADA COM SERVIDOR
    // ========================================

    const ZONE_ID = '10325249';
    const SDK_FUNC = 'show_10325249';
    const SCRIPT_SRC = 'https://libtl.com/sdk.js';

    const POSTBACK_SERVER = 'https://monetag-postback-server-production.up.railway.app';
    const POSTBACK_URL = `${POSTBACK_SERVER}/api/postback`;

    const YOUNGMONEY_API = 'https://youngmoney-api-railway-production.up.railway.app';
    const PROFILE_ENDPOINT = `${YOUNGMONEY_API}/profile`;

    let REQUIRED_IMPRESSIONS = 20;
    let REQUIRED_CLICKS = 2;
    const AUTO_REFRESH_INTERVAL = 3000;

    const TaskState = {
        userId: null,
        userEmail: null,
        impressions: 0,
        clicks: 0,
        currentClickId: null,
        isProcessing: false,
        isLoading: false,
        lastImpressions: 0,
        lastClicks: 0,
        lastEventId: 0,
        requiredImpressionsLoaded: false
    };

    let autoRefreshInterval = null;

    async function fetchRequiredImpressions() {
        try {
            console.log('[REQUIREMENTS] Buscando progresso do usu√°rio da API...');
            const url = `${YOUNGMONEY_API}/monetag/progress.php?user_id=${TaskState.userId || 1}`;
            console.log('[REQUIREMENTS] URL:', url);

            const response = await fetch(url);
            const data = await response.json();

            console.log('[REQUIREMENTS] Resposta:', data);

            if (data.success && data.data) {
                // Carregar valores necess√°rios
                REQUIRED_IMPRESSIONS = data.data.required_impressions || 20;
                REQUIRED_CLICKS = data.data.required_clicks || 2;
                
                // Carregar progresso atual do usu√°rio
                TaskState.impressions = data.data.impressions || 0;
                TaskState.clicks = data.data.clicks || 0;
                TaskState.requiredImpressionsLoaded = true;

                console.log('[REQUIREMENTS] ‚úÖ Valores carregados da API:');
                console.log('[REQUIREMENTS]   - Impress√µes atuais:', TaskState.impressions);
                console.log('[REQUIREMENTS]   - Cliques atuais:', TaskState.clicks);
                console.log('[REQUIREMENTS]   - Impress√µes necess√°rias:', REQUIRED_IMPRESSIONS);
                console.log('[REQUIREMENTS]   - Cliques necess√°rios:', REQUIRED_CLICKS);

                // Atualizar textos din√¢micos na tela
                const reqImpText = document.getElementById('requiredImpressionsText');
                const reqClickText = document.getElementById('requiredClicksText');

                if (reqImpText) {
                    reqImpText.textContent = REQUIRED_IMPRESSIONS + ' an√∫ncios';
                }
                if (reqClickText) {
                    reqClickText.textContent = REQUIRED_CLICKS + (REQUIRED_CLICKS === 1 ? ' an√∫ncio' : ' an√∫ncios');
                }

                updateUI();
            } else {
                console.warn('[REQUIREMENTS] ‚ö†Ô∏è Usando valores padr√£o');
                TaskState.requiredImpressionsLoaded = true;
                updateUI();
            }
        } catch (error) {
            console.error('[REQUIREMENTS] ‚ùå Erro ao buscar requisitos:', error);
            TaskState.requiredImpressionsLoaded = true;
            updateUI();
        }
    }

    function fetchUserProfileAsync() {
        fetch(PROFILE_ENDPOINT, {
            method: 'GET',
            headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
            credentials: 'include'
        })
        .then(response => response.ok ? response.json() : Promise.reject())
        .then(data => {
            let email = data.email || (data.user && data.user.email) || (data.data && data.data.email);
            TaskState.userEmail = email || 'unknown@youngmoney.com';
            console.log('[PROFILE] ‚úÖ Email obtido:', TaskState.userEmail);
        })
        .catch(err => {
            console.error('[PROFILE] ‚ùå Erro:', err);
            TaskState.userEmail = 'unknown@youngmoney.com';
        });
    }

    // ========================================
    // POSTBACK DO MONETAG
    // O Monetag envia os postbacks diretamente para o servidor configurado
    // na plataforma deles. N√£o precisamos interceptar nada aqui.
    // ========================================
    console.log('[POSTBACK] Usando postback oficial do Monetag (configurado na plataforma)');

    function loadMonetagSDK() {
        const script = document.createElement('script');
        script.src = SCRIPT_SRC;
        script.setAttribute('data-zone', ZONE_ID);
        script.setAttribute('data-sdk', SDK_FUNC);
        script.async = true;
        document.head.appendChild(script);
        console.log('[SDK] Carregando Monetag...');
    }

    function init() {
        console.log('='.repeat(50));
        console.log('[INIT] üöÄ Iniciando aplica√ß√£o...');
        console.log('[INIT] Servidor de Postback:', POSTBACK_SERVER);

        console.log('[INIT] window.Android existe?', typeof window.Android !== 'undefined');
        console.log('[INIT] window.AndroidInterface existe?', typeof window.AndroidInterface !== 'undefined');

        if (window.Android || window.AndroidInterface) {
            try {
                const androidInterface = window.Android || window.AndroidInterface;
                console.log('[INIT] ‚úÖ Interface Android encontrada:', androidInterface);

                const rawUserId = androidInterface.getUserId?.();
                const rawEmail = androidInterface.getEmail?.();

                console.log('[INIT] üì• Dados BRUTOS recebidos do Android:');
                console.log('[INIT]   - rawUserId:', rawUserId);
                console.log('[INIT]   - rawEmail:', rawEmail);

                TaskState.userId = rawUserId || 'guest_' + Date.now();
                TaskState.userEmail = rawEmail || 'guest@demo.com';

            } catch (e) {
                console.error('[INIT] ‚ùå ERRO ao obter dados do Android:', e);
                TaskState.userId = 'guest_' + Date.now();
                TaskState.userEmail = 'guest@demo.com';
            }
        } else {
            TaskState.userId = 'guest_' + Date.now();
            TaskState.userEmail = 'guest@demo.com';
        }

        fetchUserProfileAsync();
        fetchRequiredImpressions();
        updateUI();
        loadMonetagSDK();
        fetchStats();
    }

    async function fetchEvents() {
        try {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            console.log(`[EVENTS] [${timestamp}] Buscando novos eventos desde ID ${TaskState.lastEventId}...`);

            const url = `${POSTBACK_SERVER}/api/events?since_id=${TaskState.lastEventId}`;
            const response = await fetch(url);
            const data = await response.json();

            console.log('[EVENTS] Resposta:', data);

            if (data.success && data.events && data.events.length > 0) {
                console.log(`[EVENTS] ${data.count} novo(s) evento(s) detectado(s)!`);

                data.events.forEach(event => {
                    if (event.event_type === 'impression') {
                        TaskState.impressions++;
                    } else if (event.event_type === 'click') {
                        TaskState.clicks++;
                    }
                });

                TaskState.lastEventId = data.last_event_id;
                updateUI();
            }
        } catch (error) {
            console.error('[EVENTS] Erro ao buscar eventos:', error);
        } finally {
            TaskState.isLoading = false;
        }
    }

    async function fetchStats() {
        try {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            console.log(`[STATS] [${timestamp}] Buscando estat√≠sticas do usu√°rio ${TaskState.userId}...`);

            // Usar a API progress.php para buscar estat√≠sticas
            const url = `${YOUNGMONEY_API}/monetag/progress.php?user_id=${TaskState.userId}`;
            const response = await fetch(url);
            const data = await response.json();

            console.log('[STATS] Resposta:', data);

            if (data.success && data.data) {
                const newImpressions = data.data.impressions || 0;
                const newClicks = data.data.clicks || 0;

                const hasChanges = newImpressions !== TaskState.lastImpressions || newClicks !== TaskState.lastClicks;

                if (hasChanges) {
                    TaskState.impressions = newImpressions;
                    TaskState.clicks = newClicks;
                    TaskState.lastImpressions = newImpressions;
                    TaskState.lastClicks = newClicks;
                    
                    // Atualizar tamb√©m os valores necess√°rios caso tenham mudado
                    REQUIRED_IMPRESSIONS = data.data.required_impressions || REQUIRED_IMPRESSIONS;
                    REQUIRED_CLICKS = data.data.required_clicks || REQUIRED_CLICKS;
                    
                    updateUI();
                }
            }
        } catch (error) {
            console.error('[STATS] ‚ùå Erro ao buscar estat√≠sticas:', error);
        } finally {
            TaskState.isLoading = false;
            updateUI();
        }
    }

    function goBack() {
        console.log('[BACK] Bot√£o voltar clicado');
        if (window.Android && window.Android.closeActivity) {
            window.Android.closeActivity();
        } else if (window.history.length > 1) {
            window.history.back();
        } else {
            console.log('[BACK] Nenhuma a√ß√£o de voltar dispon√≠vel');
        }
    }

    function updateUI() {
        // Contadores (valores grandes nos boxes)
        document.getElementById('statImpressions').textContent = TaskState.impressions;
        document.getElementById('statClicks').textContent = TaskState.clicks;

        // Progresso de impress√µes (barra)
        const impressionProgress = Math.min((TaskState.impressions / REQUIRED_IMPRESSIONS) * 100, 100);
        document.getElementById('impressionBar').style.width = impressionProgress + '%';
        document.getElementById('impressionCount').textContent = `${TaskState.impressions}/${REQUIRED_IMPRESSIONS}`;

        if (TaskState.impressions >= REQUIRED_IMPRESSIONS) {
            document.getElementById('impressionBar').classList.add('completed');
        }

        // Progresso de cliques (barra)
        const clickProgress = Math.min((TaskState.clicks / REQUIRED_CLICKS) * 100, 100);
        document.getElementById('clickBar').style.width = clickProgress + '%';
        document.getElementById('clickCount').textContent = `${TaskState.clicks}/${REQUIRED_CLICKS}`;

        if (TaskState.clicks >= REQUIRED_CLICKS) {
            document.getElementById('clickBar').classList.add('completed');
        }

        // Bot√£o
        const button = document.getElementById('adButton');

        const taskCompleted = TaskState.requiredImpressionsLoaded &&
                              TaskState.impressions >= REQUIRED_IMPRESSIONS &&
                              TaskState.clicks >= REQUIRED_CLICKS;

        if (taskCompleted) {
            button.style.display = 'none';
            showStatus('<i class="fas fa-check-circle"></i> Parab√©ns! Tarefa conclu√≠da. Volte para girar a roleta!', 'success');
        } else {
            hideStatus();
            button.style.display = 'flex';
            button.disabled = TaskState.isLoading || TaskState.isProcessing;

            if (TaskState.isLoading) {
                button.innerHTML = '<span class="spinner"></span> CARREGANDO DADOS...';
            } else if (TaskState.isProcessing) {
                button.innerHTML = '<span class="spinner"></span> CARREGANDO...';
            } else {
                button.innerHTML = '<i class="fas fa-play"></i> ASSISTIR AN√öNCIO';
            }
        }
    }

    // Fun√ß√£o sendPostbackToNewServer removida.
    // O Monetag envia os postbacks diretamente para o servidor configurado na plataforma.

    function showStatus(message, type) {
        const statusEl = document.getElementById('statusMessage');
        statusEl.innerHTML = message;
        statusEl.className = `status-message ${type}`;
        statusEl.style.display = 'block';
    }

    function hideStatus() {
        const statusEl = document.getElementById('statusMessage');
        if (statusEl) {
            statusEl.style.display = 'none';
        }
    }

    function handleAdClick() {
        if (TaskState.isProcessing) return;

        TaskState.isProcessing = true;
        updateUI();

        TaskState.currentClickId = 'click_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        console.log('[AD] Click ID:', TaskState.currentClickId);

        if (typeof window[SDK_FUNC] !== 'function') {
            console.warn('[AD] SDK n√£o est√° pronto');
            TaskState.isProcessing = false;
            updateUI();
            showStatus('‚ö†Ô∏è Aguarde o carregamento...', 'warning');
            return;
        }

        console.log('[AD] Chamando SDK com ymid e requestVar');
        window[SDK_FUNC]({
            ymid: TaskState.userId,
            requestVar: TaskState.userEmail
        }).then(() => {
            console.log('[AD] ‚úÖ An√∫ncio exibido pelo Monetag');
            // O postback √© enviado automaticamente pelo Monetag para o servidor
            // configurado na plataforma. N√£o precisamos fazer nada manualmente.

            setTimeout(() => {
                TaskState.isProcessing = false;
                updateUI();
                fetchStats();
            }, 2000);
        }).catch(err => {
            console.error('[AD] ‚ùå Erro:', err);
            TaskState.isProcessing = false;
            updateUI();
        });
    }

    function startAutoRefresh() {
        console.log('[AUTO-REFRESH] Desabilitado');
    }

    function stopAutoRefresh() {
        if (autoRefreshInterval) {
            clearInterval(autoRefreshInterval);
            autoRefreshInterval = null;
        }
    }

    function openSpinWheel() {
        console.log('[SPIN] Abrindo roleta...');
        stopAutoRefresh();

        if (window.AndroidInterface?.onTaskCompleted) {
            window.AndroidInterface.onTaskCompleted();
        } else if (window.Android?.onTaskCompleted) {
            window.Android.onTaskCompleted();
        }

        if (window.Telegram?.WebApp?.close) {
            window.Telegram.WebApp.close();
        }
    }

    window.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
